"""
ğŸŒŸ MINISTERIO DEL SIGNIFICADO (Ma'nÃ¡)

Nombre Divino: Al-HÄdi (El GuÃ­a)
Pregunta Existencial: Â¿Por quÃ© hago lo que hago?

RESPONSABILIDADES:
- Definir y refinar propÃ³sito vital
- Evaluar coherencia valores-acciones
- Medir trascendencia (impacto mÃ¡s allÃ¡ de ti)
- Contemplar legado (quÃ© dejas al mundo)
- Alinear con dharma (misiÃ³n Ãºnica)

FILOSOFÃA DEL SIGNIFICADO SAGRADO:

"El significado no se encuentra.
 Se crea, capa por capa,
 en cada decisiÃ³n consciente.
 
 El reflejo de los Nombres Divinos
 en la vida humana
 es el propÃ³sito realizado."

PRINCIPIO CENTRAL:
   COHERENCIA = SIGNIFICADO REALIZADO
   
   "No importa quÃ© dices que valoras.
    Importa quÃ© haces cada dÃ­a.
    
    Tus acciones revelan tus valores reales.
    La brecha entre ambos es tu trabajo espiritual."

CAPAS DE SIGNIFICADO (De lo personal a lo universal):

1. CAPA PERSONAL: Â¿QuiÃ©n soy?
   â””â”€ Identidad profunda mÃ¡s allÃ¡ de roles
   â””â”€ Valores core (3-5 fundamentales)
   â””â”€ Fortalezas Ãºnicas (quÃ© se te da naturalmente)
   â””â”€ Sombras (quÃ© rechazas en ti mismo)
   
   Pregunta: "Si perdiera todos mis roles (padre, pareja, profesional),
              Â¿quÃ© quedarÃ­a?"

2. CAPA FAMILIAR: Â¿A quiÃ©n sirvo?
   â””â”€ PropÃ³sito en nÃºcleo familiar
   â””â”€ QuÃ© quiero dar a mi bebÃ© (valores, presencia, ejemplo)
   â””â”€ QuÃ© quiero co-crear con mi esposa
   â””â”€ Legado familiar (quÃ© recordarÃ¡n de mÃ­)
   
   Pregunta: "Â¿QuÃ© padre quiero que mi hijo recuerde?"

3. CAPA VOCACIONAL: Â¿QuÃ© ofrezco al mundo?
   â””â”€ MisiÃ³n profesional/creativa
   â””â”€ Problemas que elijo resolver
   â””â”€ Belleza/utilidad que creo
   â””â”€ A quiÃ©nes sirvo con mi trabajo
   
   Pregunta: "Si mi trabajo desapareciera maÃ±ana, Â¿quÃ© se perderÃ­a?"

4. CAPA COMUNITARIA: Â¿CÃ³mo impacto mi cÃ­rculo?
   â””â”€ Rol en familia extendida
   â””â”€ Influencia en amigos cercanos
   â””â”€ ContribuciÃ³n a colegas/comunidad
   â””â”€ Red de reciprocidad
   
   Pregunta: "Â¿CÃ³mo mejora el mundo porque existo en Ã©l?"

5. CAPA UNIVERSAL: Â¿CuÃ¡l es mi dharma?
   â””â”€ MisiÃ³n Ãºnica que solo tÃº puedes hacer
   â””â”€ IntersecciÃ³n: PasiÃ³n Ã— MaestrÃ­a Ã— Necesidad del mundo Ã— Pago
   â””â”€ Servicio mÃ¡s allÃ¡ de beneficio personal
   â””â”€ AlineaciÃ³n con lo Divino
   
   Pregunta: "Si supiera que morirÃ© en 5 aÃ±os, Â¿quÃ© cambiarÃ­a HOY?"

VALORES CORE (EvaluaciÃ³n dinÃ¡mica):

Cada persona tiene 3-5 valores fundamentales.
NO son aspiraciones. Son lo que YA valoras (revelado en acciones).

Ejemplos de valores:
- Familia/Presencia
- Creatividad/Belleza
- Libertad/AutonomÃ­a
- Crecimiento/Aprendizaje
- Servicio/Generosidad
- Excelencia/MaestrÃ­a
- Autenticidad/Verdad
- SabidurÃ­a/ContemplaciÃ³n

Para identificar valores REALES:
1. Mirar Ãºltimas 10 decisiones importantes
2. Â¿QuÃ© priorizaste en cada una?
3. Patrones recurrentes = valores reales

COHERENCIA VALORES-ACCIONES:

Coherencia = (Acciones alineadas / Acciones totales) Ã— 100

Alto (>80%): Vida integrada, paz interior
Medio (50-80%): TensiÃ³n creativa, ajustes necesarios
Bajo (<50%): Disonancia existencial, cambio urgente

Ejemplo de incoherencia:
  Valor declarado: "Familia es lo mÃ¡s importante"
  Acciones: Trabaja 80h/semana, rechaza tiempo con bebÃ©
  â†’ Valor REAL: Logro profesional > Familia
  â†’ Trabajo: Aceptar valor real O cambiar acciones

TRASCENDENCIA (Impacto mÃ¡s allÃ¡ de ti):

Niveles de impacto:
1. Inmediato: Tu familia (bebÃ©, esposa)
2. Cercano: Familia extendida, 5 amigos, 15 colegas
3. Comunidad: 150-500 personas (Dunbar extendido)
4. Generacional: Tu bebÃ© y sus hijos (3 generaciones)
5. Universal: Miles/millones (vÃ­a creaciÃ³n, enseÃ±anza, sistema)

Pregunta clave:
  "Campo Sagrado puede impactar a 1000 personas.
   Â¿Eso es mÃ¡s importante que estar presente con mi bebÃ© de 2 meses?
   
   Respuesta: NO (en esta estaciÃ³n de vida).
   El impacto mÃ¡s profundo ES la presencia con tu bebÃ©."

LEGADO (QuÃ© dejas al mundo):

3 tipos de legado:

A. LEGADO GENÃ‰TICO
   Ya cumplido: Tu bebÃ© existe.
   ContinuaciÃ³n biolÃ³gica de tu linaje.

B. LEGADO MEMÃ‰TICO (Ideas/Valores)
   Lo que enseÃ±as a tu bebÃ© (valores, sabidurÃ­a)
   Lo que creas (Campo Sagrado, sistemas, arte)
   Lo que inspiras en otros (amigos adoptan prÃ¡cticas)

C. LEGADO ESPIRITUAL (TransformaciÃ³n)
   CÃ³mo cambiaste a otros profundamente
   Despertares que facilitaste
   Amor que encarnaste

Pregunta terminal:
  "En mi lecho de muerte, Â¿quÃ© querrÃ© haber hecho?"
  
  Respuestas comunes:
  - Estar mÃ¡s presente con los que amÃ©
  - Decir la verdad mÃ¡s a menudo
  - Crear belleza
  - Servir generosamente
  
  Raramente:
  - Trabajar mÃ¡s horas
  - Acumular mÃ¡s dinero
  - Impresionar a extraÃ±os

ALINEACIÃ“N CON DHARMA:

Dharma = Tu misiÃ³n Ãºnica en esta vida

4 preguntas para encontrar dharma:
1. Â¿QuÃ© se me da naturalmente? (dones)
2. Â¿QuÃ© amo hacer? (pasiÃ³n)
3. Â¿QuÃ© necesita el mundo? (servicio)
4. Â¿Por quÃ© me pueden pagar? (sostenibilidad)

IntersecciÃ³n de las 4 = Tu dharma

Para padre de bebÃ© de 2 meses:
  Dharma actual: SER PADRE PRESENTE
  Todo lo demÃ¡s sirve a esto o espera.

PREGUNTAS PROFUNDAS (Se refinan con el tiempo):

Nivel 1 - Identidad:
  â€¢ Â¿QuiÃ©n soy mÃ¡s allÃ¡ de mis roles?
  â€¢ Â¿QuÃ© valores revelan mis acciones?
  â€¢ Â¿QuÃ© regalo Ãºnico traigo al mundo?

Nivel 2 - Relacional:
  â€¢ Â¿QuÃ© padre quiero ser?
  â€¢ Â¿QuÃ© pareja quiero ser?
  â€¢ Â¿CÃ³mo sirvo a mi cÃ­rculo?

Nivel 3 - Vocacional:
  â€¢ Â¿QuÃ© problemas elijo resolver?
  â€¢ Â¿A quiÃ©nes sirvo con mi trabajo?
  â€¢ Â¿Mi trabajo expresa mi verdad?

Nivel 4 - Existencial:
  â€¢ Â¿Por quÃ© estoy aquÃ­?
  â€¢ Â¿QuÃ© querrÃ© haber hecho antes de morir?
  â€¢ Â¿Estoy alineado con mi dharma?

Nivel 5 - Espiritual:
  â€¢ Â¿QuÃ© Nombres Divinos reflejo?
  â€¢ Â¿Soy un espejo del Amado?
  â€¢ Â¿Mi vida es una oraciÃ³n?

EVALUACIÃ“N DE COHERENCIA:

Para cada acciÃ³n, evaluar:
1. Â¿EstÃ¡ alineada con valores core?
2. Â¿Sirve a mi dharma actual?
3. Â¿Acerca mi yo real a mi yo ideal?
4. Â¿Genera significado o entropÃ­a?
5. Â¿La recordarÃ© con orgullo o arrepentimiento?

Score de coherencia: Promedio de 5 dimensiones

MÃ‰TRICAS DE SALUD:
1. Claridad propÃ³sito (0-100) - Â¿SÃ© por quÃ© estoy aquÃ­?
2. Coherencia valores-acciones (0-100) - Â¿Hago lo que valoro?
3. Impacto significativo (0-100) - Â¿Importa mi existencia?
4. Paz interior (0-100) - Â¿Estoy en mi camino?

RECORDATORIO SAGRADO:

"Tu bebÃ© de 2 meses es tu maestro.
 Te enseÃ±a presencia absoluta.
 Te recuerda lo esencial.
 Te muestra el amor sin condiciones.
 
 Campo Sagrado no es tu propÃ³sito.
 Es un VEHÃCULO para tu propÃ³sito:
 Vivir conscientemente, amar plenamente, servir generosamente.
 
 Si Campo Sagrado te aleja de tu bebÃ©,
 NO estÃ¡ alineado con tu dharma actual."

Referencia: core/arquitectura/MAPEO_7_MINISTERIOS.md
"""

from datetime import datetime, date
from typing import Dict, Any, List, Optional, Tuple
from enum import Enum
from ministerios import MinisterioBase


class CapaSignificado(Enum):
    """Capas de significado (personal â†’ universal)"""
    PERSONAL = "personal"           # Â¿QuiÃ©n soy?
    FAMILIAR = "familiar"           # Â¿A quiÃ©n sirvo?
    VOCACIONAL = "vocacional"       # Â¿QuÃ© ofrezco?
    COMUNITARIA = "comunitaria"     # Â¿CÃ³mo impacto?
    UNIVERSAL = "universal"         # Â¿CuÃ¡l es mi dharma?


class NivelImpacto(Enum):
    """Niveles de impacto trascendente"""
    INMEDIATO = "inmediato"             # Familia nuclear
    CERCANO = "cercano"                 # Familia extendida + amigos
    COMUNITARIO = "comunitario"         # 150-500 personas
    GENERACIONAL = "generacional"       # 3 generaciones
    UNIVERSAL = "universal"             # Miles/millones


class TipoLegado(Enum):
    """Tipos de legado"""
    GENETICO = "genetico"           # ContinuaciÃ³n biolÃ³gica
    MEMETICO = "memetico"           # Ideas, valores, creaciones
    ESPIRITUAL = "espiritual"       # TransformaciÃ³n profunda


class MinisterioSignificado(MinisterioBase):
    """
    ğŸŒŸ Ministerio del Significado - Al-HÄdi (El GuÃ­a)
    
    Gobierna el propÃ³sito, la coherencia, la trascendencia, el legado.
    La brÃºjula existencial que alinea todo.
    """
    
    @property
    def nombre_divino(self) -> str:
        return "Al-HÄdi (El GuÃ­a)"
    
    @property
    def pregunta_existencial(self) -> str:
        return "Â¿Por quÃ© hago lo que hago?"
    
    def estado_actual(self) -> Dict[str, Any]:
        """
        Reporta estado actual del significado.
        
        EvalÃºa:
        - Claridad de propÃ³sito en cada capa
        - Valores core identificados vs vividos
        - Coherencia entre valores y acciones
        - AlineaciÃ³n con dharma actual
        """
        # Evaluar 5 capas de significado
        capas = self._evaluar_5_capas_significado()
        
        # Identificar valores core
        valores_core = self._identificar_valores_core()
        
        # Calcular coherencia
        coherencia = self._calcular_coherencia_valores_acciones(valores_core)
        
        # Evaluar alineaciÃ³n con dharma
        dharma = self._evaluar_alineacion_dharma()
        
        return {
            "fecha": date.today().isoformat(),
            "capas_significado": capas,
            "valores_core": valores_core,
            "coherencia_global": coherencia,
            "dharma_actual": dharma,
            "preguntas_reflexion": self._generar_preguntas_reflexion(),
            "recomendacion": self._generar_recomendacion_significado(coherencia, dharma)
        }
    
    def responder_a_decreto(self, decreto: Any) -> Dict[str, Any]:
        """
        EvalÃºa decreto desde perspectiva de significado.
        
        Preguntas:
        - Â¿EstÃ¡ alineado con valores core?
        - Â¿Sirve a tu dharma actual?
        - Â¿Acerca tu yo real a tu yo ideal?
        - Â¿Genera significado o entropÃ­a?
        - Â¿Lo recordarÃ¡s con orgullo o arrepentimiento?
        """
        accion = decreto.accion_tangible.lower()
        
        # Evaluar alineaciÃ³n con valores core
        alineacion_valores = self._evaluar_alineacion_valores(accion)
        
        # Evaluar servicio a dharma
        servicio_dharma = self._evaluar_servicio_dharma(accion)
        
        # Evaluar generaciÃ³n de significado
        generacion_significado = self._evaluar_generacion_significado(accion)
        
        # Evaluar desde perspectiva de legado
        perspectiva_legado = self._evaluar_perspectiva_legado(accion)
        
        # Calcular score de coherencia existencial
        coherencia = self._calcular_coherencia_existencial(
            alineacion_valores,
            servicio_dharma,
            generacion_significado,
            perspectiva_legado
        )
        
        # Preguntas profundas especÃ­ficas
        preguntas = self._generar_preguntas_profundas(accion, coherencia)
        
        return {
            "evaluacion": "favorable" if coherencia >= 70 else "requiere_reflexion",
            "coherencia_existencial": coherencia,
            "alineacion_valores": alineacion_valores,
            "servicio_dharma": servicio_dharma,
            "generacion_significado": generacion_significado,
            "perspectiva_legado": perspectiva_legado,
            "preguntas_profundas": preguntas,
            "reflexion": self._generar_reflexion(accion, coherencia)
        }
    
    def metricas_salud(self) -> Dict[str, float]:
        """
        MÃ©tricas de salud del significado.
        """
        claridad_proposito = self._calcular_claridad_proposito()
        coherencia_valores = self._calcular_coherencia_valores_acciones_global()
        impacto_significativo = self._calcular_impacto_significativo()
        paz_interior = self._calcular_paz_interior(coherencia_valores)
        
        return {
            "claridad_proposito": claridad_proposito,
            "coherencia_valores_acciones": coherencia_valores,
            "impacto_significativo": impacto_significativo,
            "paz_interior": paz_interior
        }
    
    # =====================================================================
    # MÃ‰TODOS INTERNOS: Las 5 Capas de Significado
    # =====================================================================
    
    def _evaluar_5_capas_significado(self) -> Dict[str, Dict[str, Any]]:
        """
        EvalÃºa claridad y alineaciÃ³n en las 5 capas de significado.
        """
        return {
            "personal": {
                "capa": "Â¿QuiÃ©n soy?",
                "claridad": 75.0,  # TODO: Tracking real con journaling
                "elementos": {
                    "identidad_profunda": "Padre, creador, buscador de sabidurÃ­a",
                    "valores_core": ["Familia", "Presencia", "Crecimiento", "Servicio"],
                    "fortalezas": "SÃ­ntesis, visiÃ³n sistÃ©mica, profundidad",
                    "sombras": "Perfeccionismo, sobre-anÃ¡lisis"
                },
                "pregunta_activa": "Si perdiera todos mis roles, Â¿quÃ© quedarÃ­a?"
            },
            "familiar": {
                "capa": "Â¿A quiÃ©n sirvo?",
                "claridad": 95.0,  # MUY claro en estaciÃ³n padre reciÃ©n nacido
                "elementos": {
                    "proposito_nucleo": "Ser padre presente para bebÃ© de 2 meses",
                    "legado_para_hijo": "Presencia, amor incondicional, ejemplo de integraciÃ³n",
                    "cocreacion_esposa": "Apoyo mutuo, proyectos conjuntos, tiempo de calidad",
                    "memoria_familiar": "Padre que estuvo PRESENTE en primeros meses"
                },
                "pregunta_activa": "Â¿QuÃ© padre quiero que mi hijo recuerde?"
            },
            "vocacional": {
                "capa": "Â¿QuÃ© ofrezco al mundo?",
                "claridad": 80.0,
                "elementos": {
                    "mision": "Crear sistemas que ayuden a vivir conscientemente",
                    "problemas": "Caos organizativo, falta de presencia, desalineaciÃ³n",
                    "creacion": "Campo Sagrado como herramienta de integraciÃ³n",
                    "servicio": "Primeros usuarios: yo mismo, luego beta testers (amigos/colegas)"
                },
                "pregunta_activa": "Si mi trabajo desapareciera, Â¿quÃ© se perderÃ­a?"
            },
            "comunitaria": {
                "capa": "Â¿CÃ³mo impacto mi cÃ­rculo?",
                "claridad": 70.0,
                "elementos": {
                    "familia_extendida": "Hijo, hermano presente",
                    "amigos_cercanos": "Potencial guÃ­a hacia prÃ¡cticas contemplativas",
                    "colegas": "Co-creaciÃ³n, compartir aprendizajes",
                    "reciprocidad": "Red de apoyo mutuo"
                },
                "pregunta_activa": "Â¿CÃ³mo mejora el mundo porque existo?"
            },
            "universal": {
                "capa": "Â¿CuÃ¡l es mi dharma?",
                "claridad": 85.0,
                "elementos": {
                    "dharma_actual": "SER PADRE PRESENTE (estaciÃ³n de vida 0-12 meses)",
                    "dharma_profundo": "Sintetizar sabidurÃ­a antigua + tecnologÃ­a moderna",
                    "interseccion": "PasiÃ³n (sistemas) Ã— MaestrÃ­a (sÃ­ntesis) Ã— Necesidad (integraciÃ³n) Ã— Pago (herramientas)",
                    "servicio": "Facilitar despertar consciente en otros"
                },
                "pregunta_activa": "Si morirÃ© en 5 aÃ±os, Â¿quÃ© cambiarÃ­a HOY?"
            }
        }
    
    def _identificar_valores_core(self) -> Dict[str, Any]:
        """
        Identifica valores core (3-5 fundamentales).
        
        NO son aspiraciones. Son lo que YA se valora (revelado en acciones).
        """
        # Valores identificados por patrÃ³n de decisiones
        valores = [
            {
                "nombre": "Familia/Presencia",
                "score_vivido": 85.0,  # QuÃ© tanto lo vive
                "evidencia": "Rechaza compromisos que comprometan nÃºcleo familiar",
                "ajuste_necesario": "Ninguno - bien alineado"
            },
            {
                "nombre": "Crecimiento/Aprendizaje",
                "score_vivido": 80.0,
                "evidencia": "Invierte tiempo en sistemas como Campo Sagrado",
                "ajuste_necesario": "Balance con descanso"
            },
            {
                "nombre": "Servicio/Generosidad",
                "score_vivido": 70.0,
                "evidencia": "Piensa en beta testers, quiere compartir Campo Sagrado",
                "ajuste_necesario": "Asegurar que no comprometa nÃºcleo"
            },
            {
                "nombre": "Excelencia/MaestrÃ­a",
                "score_vivido": 75.0,
                "evidencia": "Busca 0.01% tÃ©cnico, implementaciones profundas",
                "ajuste_necesario": "Aceptar MVP imperfecto (progreso > perfecciÃ³n)"
            }
        ]
        
        return {
            "cantidad": len(valores),
            "valores": valores,
            "coherencia_promedio": sum(v["score_vivido"] for v in valores) / len(valores)
        }
    
    def _calcular_coherencia_valores_acciones(self, valores_core: Dict[str, Any]) -> float:
        """
        Calcula coherencia global entre valores y acciones.
        """
        return valores_core["coherencia_promedio"]
    
    def _evaluar_alineacion_dharma(self) -> Dict[str, Any]:
        """
        EvalÃºa alineaciÃ³n con dharma actual.
        """
        return {
            "dharma_actual": "Ser padre presente de bebÃ© de 2 meses",
            "dharma_profundo": "Sintetizar sabidurÃ­a para facilitar despertar",
            "alineacion": 90.0,  # Alto porque prioriza familia
            "tension_creativa": (
                "Campo Sagrado es vehÃ­culo para dharma profundo, "
                "pero no puede comprometer dharma actual (paternidad)."
            ),
            "resolucion": (
                "Campo Sagrado en modo sostenible (10h/semana), "
                "al servicio de organizar vida para estar mÃ¡s presente con bebÃ©."
            )
        }
    
    def _evaluar_alineacion_valores(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa alineaciÃ³n de acciÃ³n con valores core.
        """
        valores_core = self._identificar_valores_core()
        
        # Detectar quÃ© valores toca la acciÃ³n
        valores_activados = []
        
        if any(palabra in accion for palabra in ["familia", "bebÃ©", "esposa", "presencia", "tiempo juntos"]):
            valores_activados.append(("Familia/Presencia", 100))
        
        if any(palabra in accion for palabra in ["aprender", "estudiar", "sistema", "optimizar"]):
            valores_activados.append(("Crecimiento/Aprendizaje", 85))
        
        if any(palabra in accion for palabra in ["ayudar", "servir", "compartir", "beta", "enseÃ±ar"]):
            valores_activados.append(("Servicio/Generosidad", 80))
        
        if any(palabra in accion for palabra in ["excelencia", "calidad", "maestrÃ­a", "profundo"]):
            valores_activados.append(("Excelencia/MaestrÃ­a", 75))
        
        if not valores_activados:
            # AcciÃ³n neutral respecto a valores
            alineacion_promedio = 50.0
        else:
            alineacion_promedio = sum(score for _, score in valores_activados) / len(valores_activados)
        
        return {
            "alineacion_score": alineacion_promedio,
            "valores_activados": valores_activados,
            "coherente": alineacion_promedio >= 70
        }
    
    def _evaluar_servicio_dharma(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa si la acciÃ³n sirve al dharma actual.
        """
        # Dharma actual: Ser padre presente
        sirve_dharma_actual = any(palabra in accion for palabra in [
            "familia", "bebÃ©", "esposa", "descanso", "salud",
            "organizar vida", "eficiencia", "tiempo libre"
        ])
        
        # Dharma profundo: Sintetizar sabidurÃ­a
        sirve_dharma_profundo = any(palabra in accion for palabra in [
            "campo sagrado", "sistema", "sabidurÃ­a", "integraciÃ³n",
            "compartir", "enseÃ±ar", "documentar"
        ])
        
        # Compromete dharma actual
        compromete = any(palabra in accion for palabra in [
            "muchas horas", "urgente", "deadline", "viaje largo"
        ])
        
        if sirve_dharma_actual:
            score = 95.0
            categoria = "sirve_dharma_actual"
        elif sirve_dharma_profundo and not compromete:
            score = 75.0
            categoria = "sirve_dharma_profundo_sin_comprometer"
        elif compromete:
            score = 30.0
            categoria = "compromete_dharma_actual"
        else:
            score = 50.0
            categoria = "neutral"
        
        return {
            "score": score,
            "categoria": categoria,
            "sirve_actual": sirve_dharma_actual,
            "sirve_profundo": sirve_dharma_profundo,
            "compromete": compromete
        }
    
    def _evaluar_generacion_significado(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa si la acciÃ³n genera significado o entropÃ­a.
        """
        # Acciones que generan significado
        genera_significado = any(palabra in accion for palabra in [
            "crear", "construir", "enseÃ±ar", "compartir", "expresar",
            "familia", "presencia", "belleza", "servicio", "crecimiento"
        ])
        
        # Acciones neutras (mantenimiento)
        es_mantenimiento = any(palabra in accion for palabra in [
            "revisar", "actualizar", "organizar", "limpiar"
        ])
        
        # Acciones entrÃ³picas
        es_entropico = any(palabra in accion for palabra in [
            "procrastinar", "distracciÃ³n", "redes sociales", "scrolling"
        ])
        
        if genera_significado:
            score = 90.0
            categoria = "generativo"
        elif es_mantenimiento:
            score = 60.0
            categoria = "mantenimiento"
        elif es_entropico:
            score = 20.0
            categoria = "entropico"
        else:
            score = 50.0
            categoria = "neutral"
        
        return {
            "score": score,
            "categoria": categoria
        }
    
    def _evaluar_perspectiva_legado(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa acciÃ³n desde perspectiva de legado.
        
        Pregunta: "En mi lecho de muerte, Â¿estarÃ© orgulloso de haber hecho esto?"
        """
        # Acciones que construyen legado
        construye_legado = any(palabra in accion for palabra in [
            "presencia", "familia", "bebÃ©", "esposa", "amor",
            "crear", "enseÃ±ar", "servir", "belleza", "sabidurÃ­a",
            "generosidad", "autenticidad"
        ])
        
        # Acciones funcionales (no recordadas pero necesarias)
        es_funcional = any(palabra in accion for palabra in [
            "admin", "impuestos", "trÃ¡mite", "burocracia"
        ])
        
        # Acciones que se lamentarÃ­an
        se_lamentaria = any(palabra in accion for palabra in [
            "urgente de otro", "compromiso forzado", "trabajo excesivo",
            "perderme tiempo con bebÃ©"
        ])
        
        if construye_legado:
            score = 95.0
            categoria = "orgullo_futuro"
            reflexion = "En tu lecho de muerte, estarÃ¡s orgulloso de esto."
        elif es_funcional:
            score = 50.0
            categoria = "funcional_necesario"
            reflexion = "Necesario pero no memorable. Minimizar tiempo."
        elif se_lamentaria:
            score = 20.0
            categoria = "arrepentimiento_potencial"
            reflexion = "PodrÃ­as lamentar haber dicho SÃ a esto."
        else:
            score = 60.0
            categoria = "neutral"
            reflexion = "Evaluar si vale el costo de oportunidad."
        
        return {
            "score": score,
            "categoria": categoria,
            "reflexion": reflexion
        }
    
    def _calcular_coherencia_existencial(
        self,
        alineacion_valores: Dict[str, Any],
        servicio_dharma: Dict[str, Any],
        generacion_significado: Dict[str, Any],
        perspectiva_legado: Dict[str, Any]
    ) -> float:
        """
        Calcula coherencia existencial ponderada.
        
        Pesos:
        - Perspectiva legado: 30% (mÃ¡s importante)
        - Servicio dharma: 30%
        - AlineaciÃ³n valores: 25%
        - GeneraciÃ³n significado: 15%
        """
        coherencia = (
            perspectiva_legado["score"] * 0.30 +
            servicio_dharma["score"] * 0.30 +
            alineacion_valores["alineacion_score"] * 0.25 +
            generacion_significado["score"] * 0.15
        )
        
        return coherencia
    
    def _generar_preguntas_profundas(
        self,
        accion: str,
        coherencia: float
    ) -> List[str]:
        """
        Genera preguntas profundas especÃ­ficas para la acciÃ³n.
        """
        preguntas = []
        
        # Pregunta de valores
        preguntas.append("Â¿Esta acciÃ³n expresa mis valores mÃ¡s profundos?")
        
        # Pregunta de dharma
        preguntas.append("Â¿Me acerca a mi propÃ³sito o me distrae de Ã©l?")
        
        # Pregunta de legado
        preguntas.append("Si muriera maÃ±ana, Â¿querrÃ­a que esto fuera lo Ãºltimo que hice?")
        
        # Pregunta de coherencia yo real vs yo ideal
        preguntas.append("Â¿Esto es quien SOY o quien DEBERÃA ser segÃºn otros?")
        
        # Si coherencia es baja, preguntas adicionales
        if coherencia < 60:
            preguntas.append("Â¿Por quÃ© me siento obligado a hacer esto?")
            preguntas.append("Â¿QuÃ© temo que pase si digo NO?")
            preguntas.append("Â¿Estoy traicionando algo esencial en mÃ­?")
        
        return preguntas
    
    def _generar_reflexion(self, accion: str, coherencia: float) -> str:
        """
        Genera reflexiÃ³n profunda sobre la acciÃ³n.
        """
        if coherencia >= 80:
            return (
                "Esta acciÃ³n estÃ¡ profundamente alineada con tu propÃ³sito. "
                "Es una expresiÃ³n autÃ©ntica de quien eres. "
                "Adelante con claridad y paz."
            )
        elif coherencia >= 60:
            return (
                "Esta acciÃ³n tiene coherencia moderada. "
                "Puede servir a tu propÃ³sito si se hace con lÃ­mites claros. "
                "PregÃºntate: Â¿Es el momento adecuado?"
            )
        else:
            return (
                "Esta acciÃ³n tiene baja coherencia existencial. "
                "Puede que estÃ©s diciendo SÃ por obligaciÃ³n, culpa o expectativas externas. "
                "PregÃºntate: Â¿Realmente QUIERO hacer esto, o DEBO hacerlo? "
                "Recuerda: Tu bebÃ© de 2 meses nunca volverÃ¡. Elige conscientemente."
            )
    
    def _generar_preguntas_reflexion(self) -> List[Dict[str, str]]:
        """
        Genera preguntas de reflexiÃ³n para cada capa.
        """
        return [
            {
                "capa": "Personal",
                "pregunta": "Â¿QuiÃ©n soy mÃ¡s allÃ¡ de mis roles?",
                "frecuencia": "Anual"
            },
            {
                "capa": "Familiar",
                "pregunta": "Â¿QuÃ© padre quiero que mi hijo recuerde?",
                "frecuencia": "Mensual"
            },
            {
                "capa": "Vocacional",
                "pregunta": "Si mi trabajo desapareciera, Â¿quÃ© se perderÃ­a?",
                "frecuencia": "Trimestral"
            },
            {
                "capa": "Comunitaria",
                "pregunta": "Â¿CÃ³mo mejora el mundo porque existo?",
                "frecuencia": "Semestral"
            },
            {
                "capa": "Universal",
                "pregunta": "Si morirÃ© en 5 aÃ±os, Â¿quÃ© cambiarÃ­a HOY?",
                "frecuencia": "Anual"
            }
        ]
    
    def _generar_recomendacion_significado(
        self,
        coherencia: float,
        dharma: Dict[str, Any]
    ) -> str:
        """
        Genera recomendaciÃ³n basÃ¡ndose en coherencia y dharma.
        """
        if coherencia >= 80:
            return (
                f"SOSTENER: Alta coherencia ({coherencia:.0f}%). "
                f"Tus acciones expresan tus valores. "
                f"Dharma actual: {dharma['dharma_actual']}. ContinÃºa en este camino."
            )
        elif coherencia >= 60:
            return (
                f"AJUSTAR: Coherencia moderada ({coherencia:.0f}%). "
                f"Hay tensiÃ³n creativa entre valores y acciones. "
                f"Revisa quÃ© compromisos no sirven a tu dharma actual."
            )
        else:
            return (
                f"REALINEAR: Baja coherencia ({coherencia:.0f}%). "
                f"Disonancia existencial detectada. "
                f"Auditar todos los compromisos. Liberar lo que no sirve. "
                f"Volver a lo esencial: {dharma['dharma_actual']}."
            )
    
    def _calcular_claridad_proposito(self) -> float:
        """
        Calcula claridad de propÃ³sito promediando las 5 capas.
        """
        capas = self._evaluar_5_capas_significado()
        claridades = [capa["claridad"] for capa in capas.values()]
        return sum(claridades) / len(claridades)
    
    def _calcular_coherencia_valores_acciones_global(self) -> float:
        """
        Calcula coherencia global valores-acciones.
        """
        valores = self._identificar_valores_core()
        return valores["coherencia_promedio"]
    
    def _calcular_impacto_significativo(self) -> float:
        """
        Calcula impacto significativo.
        
        En estaciÃ³n padre reciÃ©n nacido:
        El impacto MÃS significativo = presencia con bebÃ©.
        """
        # HeurÃ­stica: Si estÃ¡ presente con familia, impacto es alto
        return 85.0  # TODO: Tracking real de presencia
    
    def _calcular_paz_interior(self, coherencia: float) -> float:
        """
        Calcula paz interior basÃ¡ndose en coherencia.
        
        Alta coherencia = alta paz interior.
        """
        # Paz interior correlaciona fuertemente con coherencia
        return coherencia
