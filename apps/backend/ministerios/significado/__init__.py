"""
🌟 MINISTERIO DEL SIGNIFICADO (Ma'ná)

Nombre Divino: Al-Hādi (El Guía)
Pregunta Existencial: ¿Por qué hago lo que hago?

RESPONSABILIDADES:
- Definir y refinar propósito vital
- Evaluar coherencia valores-acciones
- Medir trascendencia (impacto más allá de ti)
- Contemplar legado (qué dejas al mundo)
- Alinear con dharma (misión única)

FILOSOFÍA DEL SIGNIFICADO SAGRADO:

"El significado no se encuentra.
 Se crea, capa por capa,
 en cada decisión consciente.
 
 El reflejo de los Nombres Divinos
 en la vida humana
 es el propósito realizado."

PRINCIPIO CENTRAL:
   COHERENCIA = SIGNIFICADO REALIZADO
   
   "No importa qué dices que valoras.
    Importa qué haces cada día.
    
    Tus acciones revelan tus valores reales.
    La brecha entre ambos es tu trabajo espiritual."

CAPAS DE SIGNIFICADO (De lo personal a lo universal):

1. CAPA PERSONAL: ¿Quién soy?
   └─ Identidad profunda más allá de roles
   └─ Valores core (3-5 fundamentales)
   └─ Fortalezas únicas (qué se te da naturalmente)
   └─ Sombras (qué rechazas en ti mismo)
   
   Pregunta: "Si perdiera todos mis roles (padre, pareja, profesional),
              ¿qué quedaría?"

2. CAPA FAMILIAR: ¿A quién sirvo?
   └─ Propósito en núcleo familiar
   └─ Qué quiero dar a mi bebé (valores, presencia, ejemplo)
   └─ Qué quiero co-crear con mi esposa
   └─ Legado familiar (qué recordarán de mí)
   
   Pregunta: "¿Qué padre quiero que mi hijo recuerde?"

3. CAPA VOCACIONAL: ¿Qué ofrezco al mundo?
   └─ Misión profesional/creativa
   └─ Problemas que elijo resolver
   └─ Belleza/utilidad que creo
   └─ A quiénes sirvo con mi trabajo
   
   Pregunta: "Si mi trabajo desapareciera mañana, ¿qué se perdería?"

4. CAPA COMUNITARIA: ¿Cómo impacto mi círculo?
   └─ Rol en familia extendida
   └─ Influencia en amigos cercanos
   └─ Contribución a colegas/comunidad
   └─ Red de reciprocidad
   
   Pregunta: "¿Cómo mejora el mundo porque existo en él?"

5. CAPA UNIVERSAL: ¿Cuál es mi dharma?
   └─ Misión única que solo tú puedes hacer
   └─ Intersección: Pasión × Maestría × Necesidad del mundo × Pago
   └─ Servicio más allá de beneficio personal
   └─ Alineación con lo Divino
   
   Pregunta: "Si supiera que moriré en 5 años, ¿qué cambiaría HOY?"

VALORES CORE (Evaluación dinámica):

Cada persona tiene 3-5 valores fundamentales.
NO son aspiraciones. Son lo que YA valoras (revelado en acciones).

Ejemplos de valores:
- Familia/Presencia
- Creatividad/Belleza
- Libertad/Autonomía
- Crecimiento/Aprendizaje
- Servicio/Generosidad
- Excelencia/Maestría
- Autenticidad/Verdad
- Sabiduría/Contemplación

Para identificar valores REALES:
1. Mirar últimas 10 decisiones importantes
2. ¿Qué priorizaste en cada una?
3. Patrones recurrentes = valores reales

COHERENCIA VALORES-ACCIONES:

Coherencia = (Acciones alineadas / Acciones totales) × 100

Alto (>80%): Vida integrada, paz interior
Medio (50-80%): Tensión creativa, ajustes necesarios
Bajo (<50%): Disonancia existencial, cambio urgente

Ejemplo de incoherencia:
  Valor declarado: "Familia es lo más importante"
  Acciones: Trabaja 80h/semana, rechaza tiempo con bebé
  → Valor REAL: Logro profesional > Familia
  → Trabajo: Aceptar valor real O cambiar acciones

TRASCENDENCIA (Impacto más allá de ti):

Niveles de impacto:
1. Inmediato: Tu familia (bebé, esposa)
2. Cercano: Familia extendida, 5 amigos, 15 colegas
3. Comunidad: 150-500 personas (Dunbar extendido)
4. Generacional: Tu bebé y sus hijos (3 generaciones)
5. Universal: Miles/millones (vía creación, enseñanza, sistema)

Pregunta clave:
  "Campo Sagrado puede impactar a 1000 personas.
   ¿Eso es más importante que estar presente con mi bebé de 2 meses?
   
   Respuesta: NO (en esta estación de vida).
   El impacto más profundo ES la presencia con tu bebé."

LEGADO (Qué dejas al mundo):

3 tipos de legado:

A. LEGADO GENÉTICO
   Ya cumplido: Tu bebé existe.
   Continuación biológica de tu linaje.

B. LEGADO MEMÉTICO (Ideas/Valores)
   Lo que enseñas a tu bebé (valores, sabiduría)
   Lo que creas (Campo Sagrado, sistemas, arte)
   Lo que inspiras en otros (amigos adoptan prácticas)

C. LEGADO ESPIRITUAL (Transformación)
   Cómo cambiaste a otros profundamente
   Despertares que facilitaste
   Amor que encarnaste

Pregunta terminal:
  "En mi lecho de muerte, ¿qué querré haber hecho?"
  
  Respuestas comunes:
  - Estar más presente con los que amé
  - Decir la verdad más a menudo
  - Crear belleza
  - Servir generosamente
  
  Raramente:
  - Trabajar más horas
  - Acumular más dinero
  - Impresionar a extraños

ALINEACIÓN CON DHARMA:

Dharma = Tu misión única en esta vida

4 preguntas para encontrar dharma:
1. ¿Qué se me da naturalmente? (dones)
2. ¿Qué amo hacer? (pasión)
3. ¿Qué necesita el mundo? (servicio)
4. ¿Por qué me pueden pagar? (sostenibilidad)

Intersección de las 4 = Tu dharma

Para padre de bebé de 2 meses:
  Dharma actual: SER PADRE PRESENTE
  Todo lo demás sirve a esto o espera.

PREGUNTAS PROFUNDAS (Se refinan con el tiempo):

Nivel 1 - Identidad:
  • ¿Quién soy más allá de mis roles?
  • ¿Qué valores revelan mis acciones?
  • ¿Qué regalo único traigo al mundo?

Nivel 2 - Relacional:
  • ¿Qué padre quiero ser?
  • ¿Qué pareja quiero ser?
  • ¿Cómo sirvo a mi círculo?

Nivel 3 - Vocacional:
  • ¿Qué problemas elijo resolver?
  • ¿A quiénes sirvo con mi trabajo?
  • ¿Mi trabajo expresa mi verdad?

Nivel 4 - Existencial:
  • ¿Por qué estoy aquí?
  • ¿Qué querré haber hecho antes de morir?
  • ¿Estoy alineado con mi dharma?

Nivel 5 - Espiritual:
  • ¿Qué Nombres Divinos reflejo?
  • ¿Soy un espejo del Amado?
  • ¿Mi vida es una oración?

EVALUACIÓN DE COHERENCIA:

Para cada acción, evaluar:
1. ¿Está alineada con valores core?
2. ¿Sirve a mi dharma actual?
3. ¿Acerca mi yo real a mi yo ideal?
4. ¿Genera significado o entropía?
5. ¿La recordaré con orgullo o arrepentimiento?

Score de coherencia: Promedio de 5 dimensiones

MÉTRICAS DE SALUD:
1. Claridad propósito (0-100) - ¿Sé por qué estoy aquí?
2. Coherencia valores-acciones (0-100) - ¿Hago lo que valoro?
3. Impacto significativo (0-100) - ¿Importa mi existencia?
4. Paz interior (0-100) - ¿Estoy en mi camino?

RECORDATORIO SAGRADO:

"Tu bebé de 2 meses es tu maestro.
 Te enseña presencia absoluta.
 Te recuerda lo esencial.
 Te muestra el amor sin condiciones.
 
 Campo Sagrado no es tu propósito.
 Es un VEHÍCULO para tu propósito:
 Vivir conscientemente, amar plenamente, servir generosamente.
 
 Si Campo Sagrado te aleja de tu bebé,
 NO está alineado con tu dharma actual."

Referencia: core/arquitectura/MAPEO_7_MINISTERIOS.md
"""

from datetime import datetime, date
from typing import Dict, Any, List, Optional, Tuple
from enum import Enum
from ministerios import MinisterioBase


class CapaSignificado(Enum):
    """Capas de significado (personal → universal)"""
    PERSONAL = "personal"           # ¿Quién soy?
    FAMILIAR = "familiar"           # ¿A quién sirvo?
    VOCACIONAL = "vocacional"       # ¿Qué ofrezco?
    COMUNITARIA = "comunitaria"     # ¿Cómo impacto?
    UNIVERSAL = "universal"         # ¿Cuál es mi dharma?


class NivelImpacto(Enum):
    """Niveles de impacto trascendente"""
    INMEDIATO = "inmediato"             # Familia nuclear
    CERCANO = "cercano"                 # Familia extendida + amigos
    COMUNITARIO = "comunitario"         # 150-500 personas
    GENERACIONAL = "generacional"       # 3 generaciones
    UNIVERSAL = "universal"             # Miles/millones


class TipoLegado(Enum):
    """Tipos de legado"""
    GENETICO = "genetico"           # Continuación biológica
    MEMETICO = "memetico"           # Ideas, valores, creaciones
    ESPIRITUAL = "espiritual"       # Transformación profunda


class MinisterioSignificado(MinisterioBase):
    """
    🌟 Ministerio del Significado - Al-Hādi (El Guía)
    
    Gobierna el propósito, la coherencia, la trascendencia, el legado.
    La brújula existencial que alinea todo.
    """
    
    @property
    def nombre_divino(self) -> str:
        return "Al-Hādi (El Guía)"
    
    @property
    def pregunta_existencial(self) -> str:
        return "¿Por qué hago lo que hago?"
    
    def estado_actual(self) -> Dict[str, Any]:
        """
        Reporta estado actual del significado.
        
        Evalúa:
        - Claridad de propósito en cada capa
        - Valores core identificados vs vividos
        - Coherencia entre valores y acciones
        - Alineación con dharma actual
        """
        # Evaluar 5 capas de significado
        capas = self._evaluar_5_capas_significado()
        
        # Identificar valores core
        valores_core = self._identificar_valores_core()
        
        # Calcular coherencia
        coherencia = self._calcular_coherencia_valores_acciones(valores_core)
        
        # Evaluar alineación con dharma
        dharma = self._evaluar_alineacion_dharma()
        
        return {
            "fecha": date.today().isoformat(),
            "capas_significado": capas,
            "valores_core": valores_core,
            "coherencia_global": coherencia,
            "dharma_actual": dharma,
            "preguntas_reflexion": self._generar_preguntas_reflexion(),
            "recomendacion": self._generar_recomendacion_significado(coherencia, dharma)
        }
    
    def responder_a_decreto(self, decreto: Any) -> Dict[str, Any]:
        """
        Evalúa decreto desde perspectiva de significado.
        
        Preguntas:
        - ¿Está alineado con valores core?
        - ¿Sirve a tu dharma actual?
        - ¿Acerca tu yo real a tu yo ideal?
        - ¿Genera significado o entropía?
        - ¿Lo recordarás con orgullo o arrepentimiento?
        """
        accion = decreto.accion_tangible.lower()
        
        # Evaluar alineación con valores core
        alineacion_valores = self._evaluar_alineacion_valores(accion)
        
        # Evaluar servicio a dharma
        servicio_dharma = self._evaluar_servicio_dharma(accion)
        
        # Evaluar generación de significado
        generacion_significado = self._evaluar_generacion_significado(accion)
        
        # Evaluar desde perspectiva de legado
        perspectiva_legado = self._evaluar_perspectiva_legado(accion)
        
        # Calcular score de coherencia existencial
        coherencia = self._calcular_coherencia_existencial(
            alineacion_valores,
            servicio_dharma,
            generacion_significado,
            perspectiva_legado
        )
        
        # Preguntas profundas específicas
        preguntas = self._generar_preguntas_profundas(accion, coherencia)
        
        return {
            "evaluacion": "favorable" if coherencia >= 70 else "requiere_reflexion",
            "coherencia_existencial": coherencia,
            "alineacion_valores": alineacion_valores,
            "servicio_dharma": servicio_dharma,
            "generacion_significado": generacion_significado,
            "perspectiva_legado": perspectiva_legado,
            "preguntas_profundas": preguntas,
            "reflexion": self._generar_reflexion(accion, coherencia)
        }
    
    def metricas_salud(self) -> Dict[str, float]:
        """
        Métricas de salud del significado.
        """
        claridad_proposito = self._calcular_claridad_proposito()
        coherencia_valores = self._calcular_coherencia_valores_acciones_global()
        impacto_significativo = self._calcular_impacto_significativo()
        paz_interior = self._calcular_paz_interior(coherencia_valores)
        
        return {
            "claridad_proposito": claridad_proposito,
            "coherencia_valores_acciones": coherencia_valores,
            "impacto_significativo": impacto_significativo,
            "paz_interior": paz_interior
        }
    
    # =====================================================================
    # MÉTODOS INTERNOS: Las 5 Capas de Significado
    # =====================================================================
    
    def _evaluar_5_capas_significado(self) -> Dict[str, Dict[str, Any]]:
        """
        Evalúa claridad y alineación en las 5 capas de significado.
        """
        return {
            "personal": {
                "capa": "¿Quién soy?",
                "claridad": 75.0,  # TODO: Tracking real con journaling
                "elementos": {
                    "identidad_profunda": "Padre, creador, buscador de sabiduría",
                    "valores_core": ["Familia", "Presencia", "Crecimiento", "Servicio"],
                    "fortalezas": "Síntesis, visión sistémica, profundidad",
                    "sombras": "Perfeccionismo, sobre-análisis"
                },
                "pregunta_activa": "Si perdiera todos mis roles, ¿qué quedaría?"
            },
            "familiar": {
                "capa": "¿A quién sirvo?",
                "claridad": 95.0,  # MUY claro en estación padre recién nacido
                "elementos": {
                    "proposito_nucleo": "Ser padre presente para bebé de 2 meses",
                    "legado_para_hijo": "Presencia, amor incondicional, ejemplo de integración",
                    "cocreacion_esposa": "Apoyo mutuo, proyectos conjuntos, tiempo de calidad",
                    "memoria_familiar": "Padre que estuvo PRESENTE en primeros meses"
                },
                "pregunta_activa": "¿Qué padre quiero que mi hijo recuerde?"
            },
            "vocacional": {
                "capa": "¿Qué ofrezco al mundo?",
                "claridad": 80.0,
                "elementos": {
                    "mision": "Crear sistemas que ayuden a vivir conscientemente",
                    "problemas": "Caos organizativo, falta de presencia, desalineación",
                    "creacion": "Campo Sagrado como herramienta de integración",
                    "servicio": "Primeros usuarios: yo mismo, luego beta testers (amigos/colegas)"
                },
                "pregunta_activa": "Si mi trabajo desapareciera, ¿qué se perdería?"
            },
            "comunitaria": {
                "capa": "¿Cómo impacto mi círculo?",
                "claridad": 70.0,
                "elementos": {
                    "familia_extendida": "Hijo, hermano presente",
                    "amigos_cercanos": "Potencial guía hacia prácticas contemplativas",
                    "colegas": "Co-creación, compartir aprendizajes",
                    "reciprocidad": "Red de apoyo mutuo"
                },
                "pregunta_activa": "¿Cómo mejora el mundo porque existo?"
            },
            "universal": {
                "capa": "¿Cuál es mi dharma?",
                "claridad": 85.0,
                "elementos": {
                    "dharma_actual": "SER PADRE PRESENTE (estación de vida 0-12 meses)",
                    "dharma_profundo": "Sintetizar sabiduría antigua + tecnología moderna",
                    "interseccion": "Pasión (sistemas) × Maestría (síntesis) × Necesidad (integración) × Pago (herramientas)",
                    "servicio": "Facilitar despertar consciente en otros"
                },
                "pregunta_activa": "Si moriré en 5 años, ¿qué cambiaría HOY?"
            }
        }
    
    def _identificar_valores_core(self) -> Dict[str, Any]:
        """
        Identifica valores core (3-5 fundamentales).
        
        NO son aspiraciones. Son lo que YA se valora (revelado en acciones).
        """
        # Valores identificados por patrón de decisiones
        valores = [
            {
                "nombre": "Familia/Presencia",
                "score_vivido": 85.0,  # Qué tanto lo vive
                "evidencia": "Rechaza compromisos que comprometan núcleo familiar",
                "ajuste_necesario": "Ninguno - bien alineado"
            },
            {
                "nombre": "Crecimiento/Aprendizaje",
                "score_vivido": 80.0,
                "evidencia": "Invierte tiempo en sistemas como Campo Sagrado",
                "ajuste_necesario": "Balance con descanso"
            },
            {
                "nombre": "Servicio/Generosidad",
                "score_vivido": 70.0,
                "evidencia": "Piensa en beta testers, quiere compartir Campo Sagrado",
                "ajuste_necesario": "Asegurar que no comprometa núcleo"
            },
            {
                "nombre": "Excelencia/Maestría",
                "score_vivido": 75.0,
                "evidencia": "Busca 0.01% técnico, implementaciones profundas",
                "ajuste_necesario": "Aceptar MVP imperfecto (progreso > perfección)"
            }
        ]
        
        return {
            "cantidad": len(valores),
            "valores": valores,
            "coherencia_promedio": sum(v["score_vivido"] for v in valores) / len(valores)
        }
    
    def _calcular_coherencia_valores_acciones(self, valores_core: Dict[str, Any]) -> float:
        """
        Calcula coherencia global entre valores y acciones.
        """
        return valores_core["coherencia_promedio"]
    
    def _evaluar_alineacion_dharma(self) -> Dict[str, Any]:
        """
        Evalúa alineación con dharma actual.
        """
        return {
            "dharma_actual": "Ser padre presente de bebé de 2 meses",
            "dharma_profundo": "Sintetizar sabiduría para facilitar despertar",
            "alineacion": 90.0,  # Alto porque prioriza familia
            "tension_creativa": (
                "Campo Sagrado es vehículo para dharma profundo, "
                "pero no puede comprometer dharma actual (paternidad)."
            ),
            "resolucion": (
                "Campo Sagrado en modo sostenible (10h/semana), "
                "al servicio de organizar vida para estar más presente con bebé."
            )
        }
    
    def _evaluar_alineacion_valores(self, accion: str) -> Dict[str, Any]:
        """
        Evalúa alineación de acción con valores core.
        """
        valores_core = self._identificar_valores_core()
        
        # Detectar qué valores toca la acción
        valores_activados = []
        
        if any(palabra in accion for palabra in ["familia", "bebé", "esposa", "presencia", "tiempo juntos"]):
            valores_activados.append(("Familia/Presencia", 100))
        
        if any(palabra in accion for palabra in ["aprender", "estudiar", "sistema", "optimizar"]):
            valores_activados.append(("Crecimiento/Aprendizaje", 85))
        
        if any(palabra in accion for palabra in ["ayudar", "servir", "compartir", "beta", "enseñar"]):
            valores_activados.append(("Servicio/Generosidad", 80))
        
        if any(palabra in accion for palabra in ["excelencia", "calidad", "maestría", "profundo"]):
            valores_activados.append(("Excelencia/Maestría", 75))
        
        if not valores_activados:
            # Acción neutral respecto a valores
            alineacion_promedio = 50.0
        else:
            alineacion_promedio = sum(score for _, score in valores_activados) / len(valores_activados)
        
        return {
            "alineacion_score": alineacion_promedio,
            "valores_activados": valores_activados,
            "coherente": alineacion_promedio >= 70
        }
    
    def _evaluar_servicio_dharma(self, accion: str) -> Dict[str, Any]:
        """
        Evalúa si la acción sirve al dharma actual.
        """
        # Dharma actual: Ser padre presente
        sirve_dharma_actual = any(palabra in accion for palabra in [
            "familia", "bebé", "esposa", "descanso", "salud",
            "organizar vida", "eficiencia", "tiempo libre"
        ])
        
        # Dharma profundo: Sintetizar sabiduría
        sirve_dharma_profundo = any(palabra in accion for palabra in [
            "campo sagrado", "sistema", "sabiduría", "integración",
            "compartir", "enseñar", "documentar"
        ])
        
        # Compromete dharma actual
        compromete = any(palabra in accion for palabra in [
            "muchas horas", "urgente", "deadline", "viaje largo"
        ])
        
        if sirve_dharma_actual:
            score = 95.0
            categoria = "sirve_dharma_actual"
        elif sirve_dharma_profundo and not compromete:
            score = 75.0
            categoria = "sirve_dharma_profundo_sin_comprometer"
        elif compromete:
            score = 30.0
            categoria = "compromete_dharma_actual"
        else:
            score = 50.0
            categoria = "neutral"
        
        return {
            "score": score,
            "categoria": categoria,
            "sirve_actual": sirve_dharma_actual,
            "sirve_profundo": sirve_dharma_profundo,
            "compromete": compromete
        }
    
    def _evaluar_generacion_significado(self, accion: str) -> Dict[str, Any]:
        """
        Evalúa si la acción genera significado o entropía.
        """
        # Acciones que generan significado
        genera_significado = any(palabra in accion for palabra in [
            "crear", "construir", "enseñar", "compartir", "expresar",
            "familia", "presencia", "belleza", "servicio", "crecimiento"
        ])
        
        # Acciones neutras (mantenimiento)
        es_mantenimiento = any(palabra in accion for palabra in [
            "revisar", "actualizar", "organizar", "limpiar"
        ])
        
        # Acciones entrópicas
        es_entropico = any(palabra in accion for palabra in [
            "procrastinar", "distracción", "redes sociales", "scrolling"
        ])
        
        if genera_significado:
            score = 90.0
            categoria = "generativo"
        elif es_mantenimiento:
            score = 60.0
            categoria = "mantenimiento"
        elif es_entropico:
            score = 20.0
            categoria = "entropico"
        else:
            score = 50.0
            categoria = "neutral"
        
        return {
            "score": score,
            "categoria": categoria
        }
    
    def _evaluar_perspectiva_legado(self, accion: str) -> Dict[str, Any]:
        """
        Evalúa acción desde perspectiva de legado.
        
        Pregunta: "En mi lecho de muerte, ¿estaré orgulloso de haber hecho esto?"
        """
        # Acciones que construyen legado
        construye_legado = any(palabra in accion for palabra in [
            "presencia", "familia", "bebé", "esposa", "amor",
            "crear", "enseñar", "servir", "belleza", "sabiduría",
            "generosidad", "autenticidad"
        ])
        
        # Acciones funcionales (no recordadas pero necesarias)
        es_funcional = any(palabra in accion for palabra in [
            "admin", "impuestos", "trámite", "burocracia"
        ])
        
        # Acciones que se lamentarían
        se_lamentaria = any(palabra in accion for palabra in [
            "urgente de otro", "compromiso forzado", "trabajo excesivo",
            "perderme tiempo con bebé"
        ])
        
        if construye_legado:
            score = 95.0
            categoria = "orgullo_futuro"
            reflexion = "En tu lecho de muerte, estarás orgulloso de esto."
        elif es_funcional:
            score = 50.0
            categoria = "funcional_necesario"
            reflexion = "Necesario pero no memorable. Minimizar tiempo."
        elif se_lamentaria:
            score = 20.0
            categoria = "arrepentimiento_potencial"
            reflexion = "Podrías lamentar haber dicho SÍ a esto."
        else:
            score = 60.0
            categoria = "neutral"
            reflexion = "Evaluar si vale el costo de oportunidad."
        
        return {
            "score": score,
            "categoria": categoria,
            "reflexion": reflexion
        }
    
    def _calcular_coherencia_existencial(
        self,
        alineacion_valores: Dict[str, Any],
        servicio_dharma: Dict[str, Any],
        generacion_significado: Dict[str, Any],
        perspectiva_legado: Dict[str, Any]
    ) -> float:
        """
        Calcula coherencia existencial ponderada.
        
        Pesos:
        - Perspectiva legado: 30% (más importante)
        - Servicio dharma: 30%
        - Alineación valores: 25%
        - Generación significado: 15%
        """
        coherencia = (
            perspectiva_legado["score"] * 0.30 +
            servicio_dharma["score"] * 0.30 +
            alineacion_valores["alineacion_score"] * 0.25 +
            generacion_significado["score"] * 0.15
        )
        
        return coherencia
    
    def _generar_preguntas_profundas(
        self,
        accion: str,
        coherencia: float
    ) -> List[str]:
        """
        Genera preguntas profundas específicas para la acción.
        """
        preguntas = []
        
        # Pregunta de valores
        preguntas.append("¿Esta acción expresa mis valores más profundos?")
        
        # Pregunta de dharma
        preguntas.append("¿Me acerca a mi propósito o me distrae de él?")
        
        # Pregunta de legado
        preguntas.append("Si muriera mañana, ¿querría que esto fuera lo último que hice?")
        
        # Pregunta de coherencia yo real vs yo ideal
        preguntas.append("¿Esto es quien SOY o quien DEBERÍA ser según otros?")
        
        # Si coherencia es baja, preguntas adicionales
        if coherencia < 60:
            preguntas.append("¿Por qué me siento obligado a hacer esto?")
            preguntas.append("¿Qué temo que pase si digo NO?")
            preguntas.append("¿Estoy traicionando algo esencial en mí?")
        
        return preguntas
    
    def _generar_reflexion(self, accion: str, coherencia: float) -> str:
        """
        Genera reflexión profunda sobre la acción.
        """
        if coherencia >= 80:
            return (
                "Esta acción está profundamente alineada con tu propósito. "
                "Es una expresión auténtica de quien eres. "
                "Adelante con claridad y paz."
            )
        elif coherencia >= 60:
            return (
                "Esta acción tiene coherencia moderada. "
                "Puede servir a tu propósito si se hace con límites claros. "
                "Pregúntate: ¿Es el momento adecuado?"
            )
        else:
            return (
                "Esta acción tiene baja coherencia existencial. "
                "Puede que estés diciendo SÍ por obligación, culpa o expectativas externas. "
                "Pregúntate: ¿Realmente QUIERO hacer esto, o DEBO hacerlo? "
                "Recuerda: Tu bebé de 2 meses nunca volverá. Elige conscientemente."
            )
    
    def _generar_preguntas_reflexion(self) -> List[Dict[str, str]]:
        """
        Genera preguntas de reflexión para cada capa.
        """
        return [
            {
                "capa": "Personal",
                "pregunta": "¿Quién soy más allá de mis roles?",
                "frecuencia": "Anual"
            },
            {
                "capa": "Familiar",
                "pregunta": "¿Qué padre quiero que mi hijo recuerde?",
                "frecuencia": "Mensual"
            },
            {
                "capa": "Vocacional",
                "pregunta": "Si mi trabajo desapareciera, ¿qué se perdería?",
                "frecuencia": "Trimestral"
            },
            {
                "capa": "Comunitaria",
                "pregunta": "¿Cómo mejora el mundo porque existo?",
                "frecuencia": "Semestral"
            },
            {
                "capa": "Universal",
                "pregunta": "Si moriré en 5 años, ¿qué cambiaría HOY?",
                "frecuencia": "Anual"
            }
        ]
    
    def _generar_recomendacion_significado(
        self,
        coherencia: float,
        dharma: Dict[str, Any]
    ) -> str:
        """
        Genera recomendación basándose en coherencia y dharma.
        """
        if coherencia >= 80:
            return (
                f"SOSTENER: Alta coherencia ({coherencia:.0f}%). "
                f"Tus acciones expresan tus valores. "
                f"Dharma actual: {dharma['dharma_actual']}. Continúa en este camino."
            )
        elif coherencia >= 60:
            return (
                f"AJUSTAR: Coherencia moderada ({coherencia:.0f}%). "
                f"Hay tensión creativa entre valores y acciones. "
                f"Revisa qué compromisos no sirven a tu dharma actual."
            )
        else:
            return (
                f"REALINEAR: Baja coherencia ({coherencia:.0f}%). "
                f"Disonancia existencial detectada. "
                f"Auditar todos los compromisos. Liberar lo que no sirve. "
                f"Volver a lo esencial: {dharma['dharma_actual']}."
            )
    
    def _calcular_claridad_proposito(self) -> float:
        """
        Calcula claridad de propósito promediando las 5 capas.
        """
        capas = self._evaluar_5_capas_significado()
        claridades = [capa["claridad"] for capa in capas.values()]
        return sum(claridades) / len(claridades)
    
    def _calcular_coherencia_valores_acciones_global(self) -> float:
        """
        Calcula coherencia global valores-acciones.
        """
        valores = self._identificar_valores_core()
        return valores["coherencia_promedio"]
    
    def _calcular_impacto_significativo(self) -> float:
        """
        Calcula impacto significativo.
        
        En estación padre recién nacido:
        El impacto MÁS significativo = presencia con bebé.
        """
        # Heurística: Si está presente con familia, impacto es alto
        return 85.0  # TODO: Tracking real de presencia
    
    def _calcular_paz_interior(self, coherencia: float) -> float:
        """
        Calcula paz interior basándose en coherencia.
        
        Alta coherencia = alta paz interior.
        """
        # Paz interior correlaciona fuertemente con coherencia
        return coherencia
