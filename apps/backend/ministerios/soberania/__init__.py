"""
ğŸ›¡ï¸ MINISTERIO DE LA SOBERANÃA (Mulk)

Nombre Divino: Al-MÄlik (El Rey Soberano)
Pregunta Existencial: Â¿DÃ³nde estÃ¡n mis lÃ­mites sagrados?

RESPONSABILIDADES:
- Establecer lÃ­mites claros en cada nivel
- Decir NO con amor y claridad
- Proteger energÃ­a vital de demandas externas
- Auto-liderazgo consciente
- LiberaciÃ³n de compromisos que no sirven

FILOSOFÃA DE LA SOBERANÃA SAGRADA:

"SoberanÃ­a no es egoÃ­smo.
 Es reconocer que tu reino tiene fronteras sagradas.
 
 Decir NO a lo externo
 es decir SÃ a lo esencial.
 
 El rey que no gobierna sus fronteras
 pierde su reino por entropÃ­a."

PRINCIPIO CENTRAL:
   LÃMITES CLAROS = AMOR VERDADERO
   
   "Decir SÃ a todo
    es decir NO a lo esencial.
    
    El padre que acepta todo compromiso externo
    dice NO a su bebÃ© de 2 meses."

SOBERANÃA EN 7 NIVELES:

1. SOBERANÃA ENERGÃ‰TICA (Nivel mÃ¡s profundo)
   â””â”€ Proteger tu energÃ­a vital como recurso sagrado
   â””â”€ Rechazar demandas que agoten tu fuente
   â””â”€ Regla: Si no hay energÃ­a para lo esencial, TODO lo demÃ¡s es NO
   
   Pregunta: "Â¿Tengo energÃ­a para mi bebÃ© despuÃ©s de esto?"

2. SOBERANÃA TEMPORAL
   â””â”€ Tu tiempo es finito e irrecuperable
   â””â”€ Cada SÃ a alguien es NO a otro
   â””â”€ Regla: En estaciÃ³n padre reciÃ©n nacido, 70% del tiempo es NO-NEGOCIABLE
   
   Pregunta: "Â¿Esto vale mÃ¡s que tiempo con mi nÃºcleo familiar?"

3. SOBERANÃA RELACIONAL
   â””â”€ LÃ­mites claros con cada cÃ­rculo
   â””â”€ NO es una frase completa
   â””â”€ Regla: NÃºcleo > Familia extendida > Amigos > Colegas > ExtraÃ±os
   
   Por cÃ­rculo:
   â€¢ NÃºcleo: LÃ­mites mÃ­nimos (prioridad absoluta)
   â€¢ Familia: LÃ­mites flexibles (apoyo mutuo)
   â€¢ Amigos: LÃ­mites claros (calidad > cantidad)
   â€¢ Colegas: LÃ­mites firmes (profesional, no personal)
   â€¢ ExtraÃ±os: NO por defecto

4. SOBERANÃA DE PROYECTOS
   â””â”€ MÃ¡ximo 3 proyectos simultÃ¡neos (Ministerio Mente)
   â””â”€ TODO proyecto nuevo requiere cerrar/pausar otro
   â””â”€ Regla: En estaciÃ³n padre reciÃ©n nacido, mÃ¡ximo 2 proyectos (bebÃ© + 1)
   
   Pregunta: "Â¿QuÃ© proyecto pausarÃ© para aceptar este?"

5. SOBERANÃA FINANCIERA
   â””â”€ No todas las oportunidades son para ti
   â””â”€ Rechazar trabajo que comprometa nÃºcleo familiar
   â””â”€ Regla: Dinero perdido se recupera. Tiempo con bebÃ© de 2 meses, nunca.
   
   Pregunta: "Â¿CuÃ¡nto dinero vale perderme estos primeros meses?"

6. SOBERANÃA EMOCIONAL
   â””â”€ No eres responsable de gestionar emociones ajenas
   â””â”€ Tu NO puede decepcionar a otros (y estÃ¡ bien)
   â””â”€ Regla: Culpa por decir NO < Arrepentimiento por decir SÃ
   
   Pregunta: "Â¿Prefiero su decepciÃ³n o mi arrepentimiento?"

7. SOBERANÃA EXISTENCIAL (Nivel mÃ¡s alto)
   â””â”€ Tu vida tiene un propÃ³sito Ãºnico
   â””â”€ No todos los "deberÃ­a" aplican a ti
   â””â”€ Regla: AlineaciÃ³n con propÃ³sito > Expectativas externas
   
   Pregunta: "Â¿Esto me acerca o aleja de mi dharma?"

TIPOLOGÃA DE COMPROMISOS:

A. COMPROMISOS ESENCIALES (Siempre SÃ)
   - Salud propia (dormir, comer, ejercicio)
   - NÃºcleo familiar (bebÃ©, esposa)
   - Supervivencia (trabajo que paga cuentas)
   
B. COMPROMISOS IMPORTANTES (SÃ con lÃ­mites)
   - Familia extendida
   - Amigos cercanos
   - Proyectos alineados con propÃ³sito
   
C. COMPROMISOS OPCIONALES (SÃ solo con capacidad sobrante)
   - Eventos sociales
   - Networking
   - "Favores" no-crÃ­ticos
   
D. COMPROMISOS TÃ“XICOS (NO siempre)
   - Relaciones que drenan sin reciprocidad
   - Proyectos desalineados con valores
   - "Urgencias" de otros que no son tuyas
   - Compromisos con culpa como motivaciÃ³n

MATRIZ DE DECISIÃ“N: Â¿DECIR SÃ O NO?

Evaluar 4 dimensiones:

1. ALINEACIÃ“N CON ESENCIALES
   Alto: Â¿Fortalece nÃºcleo familiar? â†’ Considerar SÃ
   Bajo: Â¿Compromete esenciales? â†’ Considerar NO

2. COSTO EN CAPITAL (Tiempo/EnergÃ­a/Dinero)
   Bajo (<20% recursos): SÃ posible
   Medio (20-40%): SÃ con lÃ­mites claros
   Alto (>40%): NO por defecto

3. RECIPROCIDAD
   Alta: RelaciÃ³n de apoyo mutuo â†’ Considerar SÃ
   Baja: Dar sin recibir â†’ Considerar NO

4. REVERSIBILIDAD
   Reversible: Puedo cambiar de opiniÃ³n â†’ Experimentar
   Irreversible: Compromiso permanente â†’ Extrema cautela

SCORE FINAL: Î£ dimensiones â†’ SÃ (>70) / NEGOCIAR (40-70) / NO (<40)

ARTE DE DECIR NO:

Plantillas de respuesta:

1. NO DIRECTO (con amor):
   "Gracias por pensar en mÃ­. En esta etapa con mi bebÃ© de 2 meses,
    he decidido priorizar mi nÃºcleo familiar. No puedo comprometerme."

2. NO CON ALTERNATIVA:
   "No puedo ahora, pero podemos revisarlo en [3 meses / 6 meses]."

3. NO CON LÃMITES CLAROS:
   "Puedo hacer [versiÃ³n reducida] pero no [versiÃ³n completa]."

4. NO CON RECOMENDACIÃ“N:
   "No es para mÃ­, pero [nombre] podrÃ­a estar interesado."

5. NO SIN EXPLICACIÃ“N (para extraÃ±os):
   "No, gracias." [No JADE: Justify, Argue, Defend, Explain]

RECORDATORIO: NO es una frase completa. No requiere justificaciÃ³n.

LIBERACIÃ“N DE COMPROMISOS EXISTENTES:

AuditorÃ­a regular:
1. Listar todos los compromisos actuales
2. Evaluar cada uno: Â¿Sigue sirviendo?
3. Categorizar: Esencial / Importante / Opcional / TÃ³xico
4. LIBERAR: Renegociar o terminar los que ya no sirven

"Lo que fue SÃ en el pasado
 puede ser NO en el presente.
 
 Cambiar de opiniÃ³n no es fracaso.
 Es evoluciÃ³n consciente."

MÃ‰TRICAS DE SALUD:
1. Claridad de lÃ­mites (0-100) - Â¿EstÃ¡n definidos y comunicados?
2. Coherencia con lÃ­mites (0-100) - Â¿Los respetas o cedes?
3. ProtecciÃ³n de esenciales (0-100) - Â¿NÃºcleo familiar intacto?
4. LiberaciÃ³n de tÃ³xicos (0-100) - Â¿Has soltado lo que no sirve?

ALERTAS DE SOBERANÃA:
ğŸš¨ Esenciales comprometidos â†’ TODO LO DEMÃS DEBE PAUSARSE
âš ï¸ Demasiados SÃ â†’ Auditar y liberar compromisos
âš ï¸ Culpa por decir NO â†’ Trabajo emocional necesario
âš ï¸ Patrones de complacencia â†’ Terapia/coaching

Referencia: core/arquitectura/MAPEO_7_MINISTERIOS.md
"""

from datetime import datetime, date, timedelta
from typing import Dict, Any, List, Optional, Tuple
from enum import Enum
from ministerios import MinisterioBase


class NivelSoberania(Enum):
    """7 Niveles de soberanÃ­a"""
    ENERGETICA = "energetica"
    TEMPORAL = "temporal"
    RELACIONAL = "relacional"
    PROYECTOS = "proyectos"
    FINANCIERA = "financiera"
    EMOCIONAL = "emocional"
    EXISTENCIAL = "existencial"


class TipoCompromiso(Enum):
    """TipologÃ­a de compromisos"""
    ESENCIAL = "esencial"          # Siempre SÃ
    IMPORTANTE = "importante"      # SÃ con lÃ­mites
    OPCIONAL = "opcional"          # SÃ si hay capacidad sobrante
    TOXICO = "toxico"              # NO siempre


class DecisionSoberania(Enum):
    """Decisiones posibles"""
    SI_TOTAL = "si_total"                    # Adelante sin restricciones
    SI_CON_LIMITES = "si_con_limites"        # SÃ­ pero con condiciones
    NEGOCIAR = "negociar"                    # Explorar alternativas
    NO_POR_AHORA = "no_por_ahora"            # No en esta estaciÃ³n de vida
    NO_DEFINITIVO = "no_definitivo"          # No alineado con propÃ³sito


class MinisterioSoberania(MinisterioBase):
    """
    ğŸ›¡ï¸ Ministerio de la SoberanÃ­a - Al-MÄlik (El Rey Soberano)
    
    Gobierna los lÃ­mites sagrados en todos los niveles.
    Protege esenciales. Dice NO con amor.
    """
    
    @property
    def nombre_divino(self) -> str:
        return "Al-MÄlik (El Rey Soberano)"
    
    @property
    def pregunta_existencial(self) -> str:
        return "Â¿DÃ³nde estÃ¡n mis lÃ­mites sagrados?"
    
    def estado_actual(self) -> Dict[str, Any]:
        """
        Reporta estado de soberanÃ­a en 7 niveles.
        
        Para cada nivel:
        - Â¿Hay lÃ­mites claros?
        - Â¿Se estÃ¡n respetando?
        - Â¿Requieren ajuste?
        """
        # Evaluar 7 niveles de soberanÃ­a
        niveles = self._evaluar_7_niveles_soberania()
        
        # Calcular salud global
        salud_global = self._calcular_salud_soberania(niveles)
        
        # Identificar compromisos actuales
        compromisos = self._auditar_compromisos_actuales()
        
        return {
            "fecha": date.today().isoformat(),
            "niveles_soberania": niveles,
            "compromisos_actuales": compromisos,
            "salud_soberania": salud_global,
            "recomendacion": self._generar_recomendacion_soberania(niveles, compromisos)
        }
    
    def responder_a_decreto(self, decreto: Any) -> Dict[str, Any]:
        """
        EvalÃºa si decreto respeta soberanÃ­a o la compromete.
        
        Matriz de decisiÃ³n 4D:
        1. AlineaciÃ³n con esenciales
        2. Costo en capital
        3. Reciprocidad
        4. Reversibilidad
        
        Returns:
            - decision: SÃ / NO / NEGOCIAR
            - score: 0-100
            - dimensiones evaluadas
            - lÃ­mites sugeridos
            - plantilla de respuesta
        """
        accion = decreto.accion_tangible.lower()
        
        # Evaluar 4 dimensiones
        alineacion = self._evaluar_alineacion_esenciales(accion)
        costo = self._evaluar_costo_capital(accion)
        reciprocidad = self._evaluar_reciprocidad(accion)
        reversibilidad = self._evaluar_reversibilidad(accion)
        
        # Calcular score final (0-100)
        score_soberania = self._calcular_score_decision(
            alineacion, costo, reciprocidad, reversibilidad
        )
        
        # Determinar decisiÃ³n
        decision = self._determinar_decision(score_soberania, alineacion, costo)
        
        # Generar lÃ­mites sugeridos
        limites = self._generar_limites_sugeridos(decision, accion, costo, alineacion)
        
        # Plantilla de respuesta
        plantilla = self._generar_plantilla_respuesta(decision, accion)
        
        return {
            "evaluacion": "favorable" if decision in [DecisionSoberania.SI_TOTAL, DecisionSoberania.SI_CON_LIMITES] else "requiere_revision",
            "decision_soberania": decision.value,
            "score_soberania": score_soberania,
            "dimensiones": {
                "alineacion_esenciales": alineacion,
                "costo_capital": costo,
                "reciprocidad": reciprocidad,
                "reversibilidad": reversibilidad
            },
            "limites_sugeridos": limites,
            "plantilla_respuesta": plantilla,
            "alertas": self._generar_alertas_soberania(decision, alineacion, costo)
        }
    
    def metricas_salud(self) -> Dict[str, float]:
        """
        MÃ©tricas de salud de soberanÃ­a.
        """
        # Evaluar 7 niveles
        niveles = self._evaluar_7_niveles_soberania()
        
        # MÃ©tricas agregadas
        claridad_limites = sum(n["claridad"] for n in niveles.values()) / len(niveles)
        coherencia_limites = sum(n["coherencia"] for n in niveles.values()) / len(niveles)
        
        # ProtecciÃ³n de esenciales (nivel mÃ¡s crÃ­tico)
        proteccion_esenciales = min(
            niveles["energetica"]["coherencia"],
            niveles["temporal"]["coherencia"],
            niveles["relacional"]["coherencia"]
        )
        
        # LiberaciÃ³n de tÃ³xicos
        compromisos = self._auditar_compromisos_actuales()
        toxicos = compromisos["por_tipo"]["toxico"]
        liberacion = 100.0 if toxicos == 0 else max(0, 100 - (toxicos * 20))
        
        return {
            "claridad_limites": claridad_limites,
            "coherencia_limites": coherencia_limites,
            "proteccion_esenciales": proteccion_esenciales,
            "liberacion_toxicos": liberacion
        }
    
    # =====================================================================
    # MÃ‰TODOS INTERNOS: SoberanÃ­a en 7 Niveles
    # =====================================================================
    
    def _evaluar_7_niveles_soberania(self) -> Dict[str, Dict[str, Any]]:
        """
        EvalÃºa estado de soberanÃ­a en los 7 niveles.
        """
        return {
            "energetica": {
                "nivel": "SoberanÃ­a EnergÃ©tica",
                "pregunta": "Â¿Tengo energÃ­a para mi bebÃ© despuÃ©s de esto?",
                "claridad": 80.0,  # LÃ­mites claros
                "coherencia": 75.0,  # Respeto a lÃ­mites
                "limite_actual": "Rechazar demandas que agoten energÃ­a para nÃºcleo familiar",
                "estado": "sostenible"
            },
            "temporal": {
                "nivel": "SoberanÃ­a Temporal",
                "pregunta": "Â¿Esto vale mÃ¡s que tiempo con mi nÃºcleo familiar?",
                "claridad": 85.0,
                "coherencia": 70.0,
                "limite_actual": "70% del tiempo es NO-NEGOCIABLE (nÃºcleo familiar)",
                "estado": "sostenible"
            },
            "relacional": {
                "nivel": "SoberanÃ­a Relacional",
                "pregunta": "Â¿Este cÃ­rculo tiene permiso para esta demanda?",
                "claridad": 75.0,
                "coherencia": 80.0,
                "limite_actual": "NÃºcleo > Familia > Amigos > Colegas > ExtraÃ±os (NO por defecto)",
                "estado": "sostenible"
            },
            "proyectos": {
                "nivel": "SoberanÃ­a de Proyectos",
                "pregunta": "Â¿QuÃ© proyecto pausarÃ© para aceptar este?",
                "claridad": 90.0,
                "coherencia": 85.0,
                "limite_actual": "MÃ¡ximo 2 proyectos simultÃ¡neos (bebÃ© + 1)",
                "estado": "excelente"
            },
            "financiera": {
                "nivel": "SoberanÃ­a Financiera",
                "pregunta": "Â¿CuÃ¡nto dinero vale perderme estos primeros meses?",
                "claridad": 80.0,
                "coherencia": 75.0,
                "limite_actual": "Rechazar trabajo que comprometa nÃºcleo familiar",
                "estado": "sostenible"
            },
            "emocional": {
                "nivel": "SoberanÃ­a Emocional",
                "pregunta": "Â¿Prefiero su decepciÃ³n o mi arrepentimiento?",
                "claridad": 70.0,
                "coherencia": 65.0,
                "limite_actual": "Mi NO puede decepcionar (y estÃ¡ bien)",
                "estado": "en_desarrollo"
            },
            "existencial": {
                "nivel": "SoberanÃ­a Existencial",
                "pregunta": "Â¿Esto me acerca o aleja de mi dharma?",
                "claridad": 85.0,
                "coherencia": 80.0,
                "limite_actual": "AlineaciÃ³n con propÃ³sito > Expectativas externas",
                "estado": "sostenible"
            }
        }
    
    def _auditar_compromisos_actuales(self) -> Dict[str, Any]:
        """
        Audita compromisos actuales del usuario.
        
        TODO: Integrar con DB real de compromisos.
        """
        # Mock de compromisos
        compromisos_mock = [
            {"nombre": "Crianza bebÃ©", "tipo": TipoCompromiso.ESENCIAL, "tiempo_semanal": 60},
            {"nombre": "Apoyo a esposa", "tipo": TipoCompromiso.ESENCIAL, "tiempo_semanal": 15},
            {"nombre": "Campo Sagrado MVP", "tipo": TipoCompromiso.IMPORTANTE, "tiempo_semanal": 10},
            {"nombre": "Visita familia", "tipo": TipoCompromiso.IMPORTANTE, "tiempo_semanal": 4},
            {"nombre": "Networking eventos", "tipo": TipoCompromiso.OPCIONAL, "tiempo_semanal": 0},
        ]
        
        # Categorizar
        por_tipo = {
            "esencial": sum(1 for c in compromisos_mock if c["tipo"] == TipoCompromiso.ESENCIAL),
            "importante": sum(1 for c in compromisos_mock if c["tipo"] == TipoCompromiso.IMPORTANTE),
            "opcional": sum(1 for c in compromisos_mock if c["tipo"] == TipoCompromiso.OPCIONAL),
            "toxico": sum(1 for c in compromisos_mock if c["tipo"] == TipoCompromiso.TOXICO)
        }
        
        # Tiempo total
        tiempo_total = sum(c["tiempo_semanal"] for c in compromisos_mock)
        
        return {
            "total": len(compromisos_mock),
            "por_tipo": por_tipo,
            "tiempo_semanal_total": tiempo_total,
            "compromisos": compromisos_mock,
            "capacidad_restante": max(0, 60 - tiempo_total)  # Asumiendo 60h disponibles
        }
    
    def _evaluar_alineacion_esenciales(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa alineaciÃ³n con compromisos esenciales.
        
        Esenciales:
        - Salud propia
        - NÃºcleo familiar (bebÃ©, esposa)
        - Supervivencia (trabajo)
        """
        # Â¿Fortalece esenciales?
        fortalece = any(palabra in accion for palabra in [
            "salud", "dormir", "descanso", "ejercicio",
            "familia", "bebÃ©", "esposa", "pareja",
            "comida", "cuidado"
        ])
        
        # Â¿Compromete esenciales?
        compromete_palabras = [
            "urgente", "deadline corto", "fin de semana",
            "noche", "muchas horas", "viaje", "evento"
        ]
        compromete = any(palabra in accion for palabra in compromete_palabras)
        
        if fortalece:
            score = 100.0
            categoria = "fortalece_esenciales"
        elif compromete:
            score = 20.0
            categoria = "compromete_esenciales"
        else:
            score = 50.0
            categoria = "neutral"
        
        return {
            "score": score,
            "categoria": categoria,
            "fortalece": fortalece,
            "compromete": compromete
        }
    
    def _evaluar_costo_capital(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa costo en capital (tiempo/energÃ­a/dinero).
        
        Reutiliza estimaciÃ³n del Ministerio Capital.
        """
        # Estimar horas
        horas = self._estimar_horas_accion(accion)
        
        # Capital disponible (de otros ministerios)
        horas_disponibles = 44.0  # Mock
        
        # Calcular ratio
        ratio = (horas / horas_disponibles) * 100 if horas_disponibles > 0 else 100
        
        if ratio < 20:
            nivel = "bajo"
            score = 90.0
        elif ratio < 40:
            nivel = "medio"
            score = 60.0
        else:
            nivel = "alto"
            score = 30.0
        
        return {
            "score": score,
            "nivel_costo": nivel,
            "horas_estimadas": horas,
            "ratio_capital": ratio
        }
    
    def _evaluar_reciprocidad(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa reciprocidad de la relaciÃ³n/compromiso.
        """
        # Â¿Es dar sin recibir?
        es_favor = any(palabra in accion for palabra in [
            "ayudar", "favor", "apoyo a", "gratis"
        ])
        
        # Â¿Es colaboraciÃ³n mutua?
        es_colaborativo = any(palabra in accion for palabra in [
            "colaborar", "juntos", "equipo", "conjunto", "compartir"
        ])
        
        # Â¿Es para nÃºcleo familiar?
        es_familia = any(palabra in accion for palabra in [
            "bebÃ©", "esposa", "familia"
        ])
        
        if es_familia:
            score = 100.0  # Familia = reciprocidad implÃ­cita
            categoria = "familia"
        elif es_colaborativo:
            score = 80.0
            categoria = "colaborativo"
        elif es_favor:
            score = 40.0
            categoria = "unidireccional"
        else:
            score = 60.0
            categoria = "neutral"
        
        return {
            "score": score,
            "categoria": categoria
        }
    
    def _evaluar_reversibilidad(self, accion: str) -> Dict[str, Any]:
        """
        EvalÃºa si el compromiso es reversible.
        """
        # Â¿Es permanente/irreversible?
        irreversible = any(palabra in accion for palabra in [
            "contrato", "permanente", "compromiso largo",
            "sociedad", "casarse", "comprar casa"
        ])
        
        # Â¿Es puntual/reversible?
        puntual = any(palabra in accion for palabra in [
            "reuniÃ³n", "evento", "una vez", "probar", "test"
        ])
        
        if puntual:
            score = 90.0
            categoria = "reversible"
        elif irreversible:
            score = 30.0
            categoria = "irreversible"
        else:
            score = 60.0
            categoria = "semi_reversible"
        
        return {
            "score": score,
            "categoria": categoria
        }
    
    def _calcular_score_decision(
        self,
        alineacion: Dict[str, Any],
        costo: Dict[str, Any],
        reciprocidad: Dict[str, Any],
        reversibilidad: Dict[str, Any]
    ) -> float:
        """
        Calcula score final ponderado.
        
        Pesos:
        - AlineaciÃ³n con esenciales: 40% (mÃ¡s importante)
        - Costo en capital: 30%
        - Reciprocidad: 20%
        - Reversibilidad: 10%
        """
        score = (
            alineacion["score"] * 0.40 +
            costo["score"] * 0.30 +
            reciprocidad["score"] * 0.20 +
            reversibilidad["score"] * 0.10
        )
        
        return score
    
    def _determinar_decision(
        self,
        score: float,
        alineacion: Dict[str, Any],
        costo: Dict[str, Any]
    ) -> DecisionSoberania:
        """
        Determina decisiÃ³n final basÃ¡ndose en score y reglas.
        """
        # Regla absoluta: Si compromete esenciales, NO
        if alineacion["compromete"]:
            return DecisionSoberania.NO_DEFINITIVO
        
        # Regla absoluta: Si fortalece esenciales, SÃ
        if alineacion["fortalece"]:
            return DecisionSoberania.SI_TOTAL
        
        # Basado en score
        if score >= 70:
            return DecisionSoberania.SI_TOTAL
        elif score >= 55:
            return DecisionSoberania.SI_CON_LIMITES
        elif score >= 40:
            return DecisionSoberania.NEGOCIAR
        elif costo["nivel_costo"] == "alto":
            return DecisionSoberania.NO_POR_AHORA
        else:
            return DecisionSoberania.NO_DEFINITIVO
    
    def _generar_limites_sugeridos(
        self,
        decision: DecisionSoberania,
        accion: str,
        costo: Dict[str, Any],
        alineacion: Dict[str, Any]
    ) -> List[str]:
        """
        Genera lÃ­mites especÃ­ficos segÃºn decisiÃ³n.
        """
        limites = []
        
        if decision == DecisionSoberania.SI_TOTAL:
            limites.append("âœ… Adelante sin restricciones adicionales")
            
        elif decision == DecisionSoberania.SI_CON_LIMITES:
            limites.append("âš ï¸ SÃ, pero con estos lÃ­mites:")
            
            if costo["horas_estimadas"] > 5:
                limites.append(f"   â€¢ MÃ¡ximo {costo['horas_estimadas']/2:.0f}h (reducir scope 50%)")
            
            limites.append("   â€¢ Solo en horarios que no comprometan nÃºcleo familiar")
            limites.append("   â€¢ Derecho a cancelar si situaciÃ³n familiar lo requiere")
            
            if costo["nivel_costo"] == "medio":
                limites.append("   â€¢ Coordinar con esposa para apoyo con bebÃ©")
        
        elif decision == DecisionSoberania.NEGOCIAR:
            limites.append("ğŸ¤ Negociar antes de comprometerse:")
            limites.append("   â€¢ Proponer versiÃ³n reducida")
            limites.append("   â€¢ Extender plazo")
            limites.append("   â€¢ Pedir recursos/apoyo adicional")
        
        elif decision == DecisionSoberania.NO_POR_AHORA:
            limites.append("â¸ï¸ NO en esta estaciÃ³n de vida:")
            limites.append("   â€¢ Revisar en 3-6 meses (bebÃ© mÃ¡s grande)")
            limites.append("   â€¢ Mantener puerta abierta para futuro")
        
        else:  # NO_DEFINITIVO
            limites.append("ğŸ›‘ NO. No estÃ¡ alineado con esenciales.")
            limites.append("   â€¢ Compromete nÃºcleo familiar")
            limites.append("   â€¢ Decir NO es decir SÃ a lo esencial")
        
        return limites
    
    def _generar_plantilla_respuesta(
        self,
        decision: DecisionSoberania,
        accion: str
    ) -> str:
        """
        Genera plantilla de respuesta segÃºn decisiÃ³n.
        """
        if decision == DecisionSoberania.SI_TOTAL:
            return (
                "SÃ­, cuenta conmigo. Me parece que esto estÃ¡ alineado con "
                "mis prioridades actuales."
            )
        
        elif decision == DecisionSoberania.SI_CON_LIMITES:
            return (
                "Me interesa, pero necesito establecer algunos lÃ­mites claros. "
                "Como padre de un bebÃ© de 2 meses, mi disponibilidad es limitada. "
                "Â¿Podemos hablar sobre cÃ³mo adaptar esto a mi situaciÃ³n actual?"
            )
        
        elif decision == DecisionSoberania.NEGOCIAR:
            return (
                "Gracias por pensar en mÃ­. Mi situaciÃ³n actual (padre de bebÃ© reciÃ©n nacido) "
                "limita mi disponibilidad. Â¿Podemos explorar una versiÃ³n mÃ¡s ligera "
                "o con un plazo mÃ¡s largo?"
            )
        
        elif decision == DecisionSoberania.NO_POR_AHORA:
            return (
                "Gracias por la invitaciÃ³n. En esta etapa con mi bebÃ© de 2 meses, "
                "he decidido priorizar mi nÃºcleo familiar. Â¿Podemos revisarlo en "
                "[3/6] meses cuando mi situaciÃ³n sea mÃ¡s estable?"
            )
        
        else:  # NO_DEFINITIVO
            return (
                "Gracias por pensar en mÃ­, pero no puedo comprometerme con esto. "
                "Mi prioridad absoluta es mi nÃºcleo familiar. "
                "Te deseo lo mejor en esto."
            )
    
    def _generar_alertas_soberania(
        self,
        decision: DecisionSoberania,
        alineacion: Dict[str, Any],
        costo: Dict[str, Any]
    ) -> List[str]:
        """
        Genera alertas de soberanÃ­a.
        """
        alertas = []
        
        if alineacion["compromete"]:
            alertas.append("ğŸš¨ ALERTA CRÃTICA: Esto compromete tus esenciales (nÃºcleo familiar)")
            alertas.append("ğŸ›¡ï¸ SOBERANÃA: Decir NO es decir SÃ a tu bebÃ© de 2 meses")
        
        if costo["nivel_costo"] == "alto" and decision not in [DecisionSoberania.NO_POR_AHORA, DecisionSoberania.NO_DEFINITIVO]:
            alertas.append("âš ï¸ ALTO COSTO: Esto consume >40% de tu capital disponible")
        
        if decision == DecisionSoberania.SI_TOTAL and not alineacion["fortalece"]:
            alertas.append("ğŸ’¡ REFLEXIÃ“N: Â¿Seguro que esto vale mÃ¡s que tiempo con tu nÃºcleo?")
        
        return alertas
    
    def _calcular_salud_soberania(self, niveles: Dict[str, Dict[str, Any]]) -> float:
        """
        Calcula salud global de soberanÃ­a.
        """
        # Promedio de coherencia en los 7 niveles
        coherencias = [nivel["coherencia"] for nivel in niveles.values()]
        return sum(coherencias) / len(coherencias)
    
    def _generar_recomendacion_soberania(
        self,
        niveles: Dict[str, Dict[str, Any]],
        compromisos: Dict[str, Any]
    ) -> str:
        """
        Genera recomendaciÃ³n de soberanÃ­a.
        """
        # Identificar nivel mÃ¡s dÃ©bil
        nivel_mas_debil = min(niveles.items(), key=lambda x: x[1]["coherencia"])
        
        if nivel_mas_debil[1]["coherencia"] < 60:
            return (
                f"PRIORIDAD: Fortalecer {nivel_mas_debil[1]['nivel']}. "
                f"Pregunta guÃ­a: {nivel_mas_debil[1]['pregunta']}"
            )
        
        # Si hay compromisos tÃ³xicos
        if compromisos["por_tipo"]["toxico"] > 0:
            return (
                f"LIBERAR: Tienes {compromisos['por_tipo']['toxico']} compromiso(s) tÃ³xico(s). "
                "Renegociar o terminar."
            )
        
        # Estado general saludable
        return (
            "SOSTENER: LÃ­mites claros y coherentes en los 7 niveles. "
            "Continuar protegiendo esenciales."
        )
    
    def _estimar_horas_accion(self, accion: str) -> float:
        """
        Estima horas requeridas (reutiliza lÃ³gica de Capital).
        """
        if any(palabra in accion for palabra in ["implementar", "construir", "desarrollar", "sistema"]):
            return 20.0
        elif any(palabra in accion for palabra in ["crear", "diseÃ±ar", "escribir"]):
            return 5.0
        elif any(palabra in accion for palabra in ["revisar", "actualizar", "organizar"]):
            return 2.0
        else:
            return 3.0
