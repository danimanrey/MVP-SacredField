# ๐๏ธ ARQUITECTURA TรCNICA - CAMPO SAGRADO

**Versiรณn**: 0.1.0-mvp (SvelteKit)  
**Prรณxima versiรณn**: 0.2.0-alpha (Next.js + R3F)  
**Fecha**: 9 de Octubre de 2025

---

## ๐ ARQUITECTURA GENERAL

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        USUARIO                              โ
โ                          โโ                                 โ
โ              http://localhost:5173                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FRONTEND (SvelteKit)                     โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ    โ
โ  โ   Espejo     โ  โ   Estados    โ  โ    Vistas    โ    โ
โ  โ   Diario     โ  โ     Cero     โ  โ   Temporales โ    โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ    โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ    โ
โ  โ     7        โ  โ   Ley de     โ  โ  Geometrรญa   โ    โ
โ  โ Dimensiones  โ  โ   la Octava  โ  โ   Sagrada    โ    โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โโ
                    Fetch API (REST)
                           โโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  BACKEND (FastAPI + Python)                 โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                    API LAYER                          โ โ
โ  โ                                                       โ โ
โ  โ  /api/estado-cero/*    /api/espejo-diario/*         โ โ
โ  โ  /api/octavas/*        /api/manifestaciones/*        โ โ
โ  โ  /api/vista-semanal    /api/contexto-temporal        โ โ
โ  โ  /api/guardian/*       /api/orquestador/*            โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                           โโ                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                  AGENTES LAYER                        โ โ
โ  โ                                                       โ โ
โ  โ  โโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโ โ โ
โ  โ  โ Estado   โ โEntrelaz  โ โOrquest   โ โDocumen โ โ โ
โ  โ  โ  Cero    โ โ  ador    โ โ ador     โ โ tador  โ โ โ
โ  โ  โโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโ โ โ
โ  โ       โโ            โโ           โโ          โโ      โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ โ
โ  โ  โ              Guardiรกn                         โ   โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                           โโ                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                 SERVICES LAYER                        โ โ
โ  โ                                                       โ โ
โ  โ  - Motor Prisma (personalizaciรณn)                    โ โ
โ  โ  - Gestor Octavas (Ley del 7)                        โ โ
โ  โ  - Calendario Hijri (12 meses)                       โ โ
โ  โ  - Tiempos Litรบrgicos (PrayTimes)                    โ โ
โ  โ  - Claude Client (IA)                                โ โ
โ  โ  - Metabolizador Metadatos (aprendizaje)             โ โ
โ  โ  - Sumario Contexto (compresiรณn)                     โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                           โโ                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                   DATA LAYER                          โ โ
โ  โ                                                       โ โ
โ  โ  - SQLAlchemy ORM                                     โ โ
โ  โ  - Pydantic Models                                    โ โ
โ  โ  - SQLite Database (storage/organismo.db)            โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                INTEGRACIONES EXTERNAS                       โ
โ                                                             โ
โ  - Anthropic Claude API (IA generativa)                    โ
โ  - Obsidian Vault (documentaciรณn automรกtica)               โ
โ  - Google Calendar (prรณximamente)                          โ
โ  - Anytype (preparado)                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง TECNOLOGรAS Y VERSIONES

### Backend (Python 3.11)

```txt
fastapi==0.111.0           # Framework web
uvicorn==0.30.1            # Servidor ASGI
SQLAlchemy==2.0.32         # ORM
pydantic==2.8.2            # Validaciรณn de datos
anthropic==0.34.0          # Claude API
praytimes==2.1.0           # Cรกlculos astronรณmicos
hijri-converter==2.3.2     # Calendario lunar
pytz==2024.1               # Timezones
```

### Frontend (SvelteKit 5)

```json
{
  "svelte": "^5.0.0",
  "sveltekit": "^2.0.0",
  "typescript": "^5.0.0",
  "vite": "^5.0.0"
}
```

---

## ๐ฆ ESTRUCTURA DE ARCHIVOS

### Backend

```
backend/
โโโ agentes/                    # Los 4 agentes + Guardiรกn
โ   โโโ estado_cero.py         # Consultas sacrales
โ   โโโ entrelazador.py        # Estructura semanal
โ   โโโ orquestador.py         # Plan diario
โ   โโโ documentador.py        # Integraciรณn Obsidian
โ   โโโ guardian.py            # Monitoreo
โโโ api/                        # Endpoints REST
โ   โโโ main.py                # App principal
โ   โโโ estado_cero.py
โ   โโโ espejo_diario.py
โ   โโโ vistas_temporales.py
โ   โโโ octavas.py             # Ley de la Octava
โ   โโโ manifestaciones.py     # 7 Dimensiones
โโโ models/                     # Modelos de datos
โ   โโโ schemas.py             # Schemas Pydantic
โ   โโโ database.py            # Models SQLAlchemy
โ   โโโ prisma_personal.py     # Configuraciรณn usuario
โ   โโโ ley_octava.py          # Sistema de octavas
โโโ services/                   # Lรณgica de negocio
โ   โโโ calendario_hijri.py    # 12 meses lunares
โ   โโโ tiempos_liturgicos.py  # Cรกlculos astronรณmicos
โ   โโโ motor_prisma.py        # Personalizaciรณn
โ   โโโ gestor_octavas.py      # Ley del 7
โ   โโโ claude_client.py       # IA
โ   โโโ contexto.py            # Recopilaciรณn contexto
โ   โโโ sumario_contexto.py    # Compresiรณn inteligente
โ   โโโ metabolizador_metadatos.py  # Aprendizaje patrones
โโโ integraciones/
โ   โโโ obsidian.py            # Vault integration
โ   โโโ anytype.py             # Preparado
โโโ scripts/
โ   โโโ configurar_prisma.py   # CLI interactivo
โ   โโโ init_db.py             # Inicializar DB
โโโ config.py                   # Configuraciรณn central
โโโ requirements.txt
โโโ run.py                      # Entry point
```

### Frontend

```
frontend/
โโโ src/
โ   โโโ routes/                         # Pรกginas
โ   โ   โโโ +layout.svelte             # Layout principal
โ   โ   โโโ +page.svelte               # Home
โ   โ   โโโ espejo-diario/
โ   โ   โโโ estado-cero/
โ   โ   โโโ dimensiones/
โ   โ   โโโ ley-octava/
โ   โ   โโโ vista-semanal/
โ   โ   โโโ vista-anual/
โ   โโโ lib/
โ   โ   โโโ components/
โ   โ   โ   โโโ EspejoDiario/
โ   โ   โ   โ   โโโ EspejoDinamico.svelte
โ   โ   โ   โ   โโโ JornadaCaos.svelte
โ   โ   โ   โ   โโโ NoNegociables.svelte
โ   โ   โ   โโโ EstadoCero/
โ   โ   โ   โ   โโโ ConsultaSacral.svelte
โ   โ   โ   โ   โโโ ChatClarificador.svelte
โ   โ   โ   โ   โโโ VerificacionMomento.svelte
โ   โ   โ   โโโ Vistas/
โ   โ   โ   โ   โโโ VistaSemanal.svelte
โ   โ   โ   โ   โโโ VistaAnual.svelte
โ   โ   โ   โโโ Octavas/
โ   โ   โ   โ   โโโ DashboardOctavas.svelte
โ   โ   โ   โ   โโโ EspiralOctavas.svelte
โ   โ   โ   โโโ Dimensiones/
โ   โ   โ   โ   โโโ VistaDimensiones.svelte
โ   โ   โ   โโโ Shared/
โ   โ   โ       โโโ Navegacion.svelte
โ   โ   โ       โโโ GeometriaSagrada.svelte
โ   โ   โ       โโโ TiempoLiturgico.svelte
โ   โ   โโโ api/
โ   โ   โ   โโโ client.ts              # Cliente API
โ   โ   โโโ stores/
โ   โ       โโโ estadoCero.ts
โ   โ       โโโ jornada.ts
โ   โ       โโโ tiempo.ts
โ   โโโ app.css
โ   โโโ app.html
โโโ package.json
โโโ svelte.config.js
โโโ vite.config.ts
```

---

## ๐ FLUJO DE DATOS

### 1. Estado Cero

```
Usuario โ Frontend โ POST /api/estado-cero/iniciar
                       โ
              AgenteEstadoCero
                       โ
              1. Verificar ventana litรบrgica
              2. Recopilar contexto (Calendario, Tiempos, Prisma)
              3. Generar preguntas con Claude (dinรกmicas 1-20)
                       โ
              โ Retorna preguntas
                       โ
Usuario responde โ POST /api/estado-cero/responder
                       โ
              AgenteEstadoCero
                       โ
              1. Analizar respuestas
              2. Sintetizar direcciรณn (Claude Haiku)
              3. Generar acciรณn concreta
              4. Actualizar Espejo Diario
                       โ
              AgenteDocumentador
                       โ
              Guardar en Obsidian Vault
                       โ
              โ Retorna direcciรณn + acciรณn
```

### 2. Espejo Diario

```
Usuario โ GET /api/espejo-diario/hoy
             โ
     ยฟExiste espejo hoy?
             โ
        No โ Generar
             โ
     AgenteEntrelazador
             โ
     1. Obtener estructura base (anclas + no-neg)
     2. Consultar Prisma (horarios, duraciรณn flujo)
     3. Obtener contexto temporal (mes Hijri, dรญa semana)
             โ
     AgenteOrquestador
             โ
     1. Generar plan coordinado con Claude
     2. Asignar bloques profundos
     3. Respetar espacio libre dinรกmico (25-60%)
     4. Priorizar segรบn dimensiรณn del dรญa
             โ
     โ Retorna JornadaAlBordeCaos
             โ
     Se actualiza con cada Estado Cero
```

### 3. Objetivo en Octava

```
Usuario โ POST /api/octavas/crear-objetivo
             โ
     GestorOctavas
             โ
     1. Determinar nota fundamental (segรบn dimensiรณn)
     2. Generar 7 armรณnicos (todas las dimensiones)
     3. Crear plan semanal de 7 fases
     4. Programar 2 shocks conscientes
             โ
     โ Retorna ObjetivoOctava
             โ
     Cada dรญa:
     GET /api/octavas/dimension-hoy
             โ
     Sistema indica quรฉ dimensiรณn priorizar
             โ
     Entrelazador ajusta plan segรบn nota del dรญa
```

---

## ๐๏ธ MODELO DE DATOS

### Tablas Principales (SQLite)

```sql
-- Estados Cero
CREATE TABLE estados_cero (
    id TEXT PRIMARY KEY,
    fecha DATETIME,
    momento TEXT,  -- fajr, dhuhr, asr, maghrib, isha
    contexto TEXT,  -- JSON
    preguntas TEXT,  -- JSON
    respuestas TEXT,  -- JSON
    direccion TEXT,
    accion TEXT,  -- JSON
    chat TEXT,  -- JSON
    completado BOOLEAN
);

-- Sesiones de trabajo
CREATE TABLE sesiones (
    id TEXT PRIMARY KEY,
    fecha DATE,
    inicio DATETIME,
    fin DATETIME,
    duracion_minutos INTEGER,
    rol TEXT,  -- deep_work, shallow, meeting
    calidad_flujo INTEGER,  -- 1-5
    dimension TEXT,
    notas TEXT
);

-- No-negociables tracking
CREATE TABLE no_negociables_tracking (
    id TEXT PRIMARY KEY,
    fecha DATE,
    no_negociable_id TEXT,
    completado BOOLEAN,
    hora_completado DATETIME
);

-- Biometrรญa
CREATE TABLE biometria (
    id TEXT PRIMARY KEY,
    fecha DATE,
    hrv FLOAT,
    calidad_sueno INTEGER,
    energia_despertar INTEGER,
    luz_solar_am BOOLEAN,
    ejercicio BOOLEAN
);
```

### Modelos Pydantic Clave

```python
# Contexto Completo
class ContextoCompleto(BaseModel):
    temporal: ContextoTemporal
    biologico: ContextoBiologico
    financiero: ContextoFinanciero
    conocimiento: ContextoConocimiento
    tiempo_disponible_hoy: int

# Estado Cero
class EstadoCeroCompleto(BaseModel):
    id: str
    fecha: datetime
    momento: MomentoLiturgico
    contexto: ContextoCompleto
    preguntas: List[PreguntaBinaria]
    respuestas: List[RespuestaSacral]
    direccion: str
    accion: AccionConcreta
    chat: List[MensajeChat]

# Jornada al Borde del Caos
class JornadaAlBordeCaos(BaseModel):
    fecha: date
    estructura: EstructuraDia
    bloques_asignados: List[BloqueAsignado]
    espacio_libre_minutos: int
    espacio_libre_porcentaje: float
    coherencia: float

# Objetivo Octava
class ObjetivoOctava(BaseModel):
    id: str
    nombre: str
    nota_fundamental: Nota
    dimension_primaria: DimensionOctava
    armonicos: Dict[DimensionOctava, Armonico]
    plan_octava: Dict[DiaSemanaOctava, FaseSemanal]
    shocks: List[ShockConsciente]
    octava_actual: int
    nivel_frecuencia: float
```

---

## ๐ฏ COMPONENTES CLAVE

### 1. Motor del Prisma

**Propรณsito**: Traduce tu configuraciรณn รบnica en parรกmetros operativos.

**Input**: `PrismaPersonal` (config/prisma_personal.json)

**Output**: Configuraciones especรญficas para cada agente

```python
class MotorPrisma:
    def configurar_estado_cero() -> Dict:
        return {
            "numero_preguntas": calcular_dinamico(),  # 1-20
            "estilo_preguntas": adaptar_a_personalidad(),
            "categorias_prioritarias": desde_manifestaciones()
        }
    
    def configurar_entrelazador() -> Dict:
        return {
            "duracion_bloque": usuario.duracion_optima_flujo,
            "horarios_pico": usuario.mejor_momento_dia,
            "espacio_libre": calcular_dinamico()  # 25-60%
        }
```

### 2. Gestor de Octavas

**Propรณsito**: Implementa la Ley del Siete en objetivos.

**Features**:
- Crea objetivos con 7 armรณnicos
- Tracking semanal por nota
- Detecta shocks pendientes
- Calcula coherencia armรณnica
- Evoluciona en espiral ascendente

**API Principal**:
```python
gestor.crear_objetivo_octava(...)
gestor.obtener_estado_octava_actual(objetivo_id, fecha)
gestor.aplicar_shock_consciente(objetivo_id, tipo_shock, notas)
gestor.analizar_armonicos(objetivo_id)
gestor.visualizar_espiral_octavas(objetivo_id)
```

### 3. Calculador Tiempos Litรบrgicos

**Propรณsito**: Calcula con precisiรณn astronรณmica los 5 tiempos de rezo.

**Mรฉtodo**: `PrayTimes` con coordenadas exactas (San Sebastiรกn de los Reyes)

**Precisiรณn**: Al minuto

```python
calculador = CalculadorTiemposLiturgicos(
    latitud=40.5472,  # 40ยฐ32'50"N
    longitud=-3.6228,  # 3ยฐ37'22"W
    timezone="Europe/Madrid"
)

tiempos = calculador.calcular_tiempos_hoy()
# โ Fajr: 06:46-08:19
# โ Dhuhr: 14:02-17:13
# โ Asr: 17:13-19:43
# โ Maghrib: 19:43-21:09
# โ Isha: 21:09-01:25
```

### 4. Calendario Hijri

**Propรณsito**: Calendario lunar islรกmico autรฉntico con profundidad mรญstica.

**Librerรญa**: `hijri-converter` (conversiรณn precisa)

**Features**:
- 12 meses lunares REALES
- Enseรฑanzas mรญsticas sufรญes por mes
- Ayat del Corรกn relacionadas
- 4 meses sagrados identificados
- Propรณsito de cada dรญa de la semana

```python
calendario = CalendarioHijri()

mes_actual = calendario.obtener_mes_actual()
# โ nombre: "Rabi' al-Thani"
# โ enseรฑanza: "Tu existencia es acto creativo..."
# โ ayat: "Corรกn 55:1-4"

dia_hoy = calendario.obtener_dia_semana()
# โ nombre: "Jueves"
# โ proposito: "Expansiรณn y sabidurรญa..."
# โ alerta_sesgo: "Exceso de optimismo sin realismo"
```

---

## ๐ API REFERENCE RESUMIDA

### Estado Cero
```
POST /api/estado-cero/iniciar
POST /api/estado-cero/responder
POST /api/estado-cero/chat
POST /api/estado-cero/completar
GET  /api/estado-cero/ventanas-perdidas
```

### Espejo Diario
```
GET  /api/espejo-diario/hoy
POST /api/espejo-diario/actualizar
GET  /api/espejo-diario/estados-cero-hoy
```

### Vistas Temporales
```
GET /api/contexto-temporal
GET /api/vista-semanal
GET /api/vista-mensual
GET /api/vista-anual
GET /api/dias-semana
GET /api/meses-hijri
```

### Ley de la Octava
```
GET  /api/octavas/correspondencias
GET  /api/octavas/dimension-hoy
POST /api/octavas/crear-objetivo
GET  /api/octavas/objetivo/{id}
GET  /api/octavas/objetivo/{id}/estado
GET  /api/octavas/objetivo/{id}/armonicos
POST /api/octavas/objetivo/{id}/shock
GET  /api/octavas/shocks-hoy
GET  /api/octavas/objetivo/{id}/espiral
```

### Guardiรกn
```
GET  /api/guardian/salud-sistema
GET  /api/guardian/patrones
GET  /api/guardian/alertas
GET  /api/guardian/estado-general
POST /api/guardian/reporte-diario
```

---

## โก PERFORMANCE Y OPTIMIZACIรN

### Backend

**Optimizaciones actuales**:
- Claude Haiku para tareas simples (92% menos costo)
- Compresiรณn de prompts (75% reducciรณn)
- Cache de cรกlculos astronรณmicos (24h)
- Sumario incremental de contexto

**Mรฉtricas**:
- Latencia promedio: <200ms
- Estado Cero completo: <5s
- Costo por Estado Cero: ~$0.02

### Frontend

**Optimizaciones actuales**:
- CSS nativo (sin framework, bundle pequeรฑo)
- Lazy loading de componentes
- Fetch solo cuando necesario
- Revalidaciรณn cada 5 minutos

**Mรฉtricas**:
- Bundle size: ~80 KB
- First Contentful Paint: <1s
- Time to Interactive: <2s

---

## ๐ SEGURIDAD Y PRIVACIDAD

### Datos Sensibles:
- Todos los Estados Cero se guardan localmente (SQLite)
- Claude solo recibe contexto mรญnimo (sin info personal)
- Obsidian vault es local
- No hay tracking de terceros

### Configuraciรณn:
```python
# backend/.env
ANTHROPIC_API_KEY=sk-...
OBSIDIAN_VAULT_PATH=/ruta/a/vault
LATITUD=40.5472
LONGITUD=-3.6228
```

---

## ๐ DEPLOYMENT

### Desarrollo

```bash
# Terminal 1: Backend
cd backend
source venv/bin/activate
python run.py

# Terminal 2: Frontend
cd frontend
npm run dev

# Acceso: http://localhost:5173
```

### Producciรณn (prรณximamente)

**Backend**: Railway / Render / DigitalOcean  
**Frontend**: Vercel / Netlify  
**Base de datos**: PostgreSQL (migraciรณn desde SQLite)

---

## ๐ MรTRICAS DEL SISTEMA

### Cรณdigo:
- **Backend**: ~5000 lรญneas Python
- **Frontend**: ~3000 lรญneas Svelte/TS
- **Total**: ~8000 lรญneas

### Endpoints:
- **Total**: 30+ endpoints
- **Cobertura**: Completa

### Componentes:
- **Backend**: 15 archivos principales
- **Frontend**: 15+ componentes
- **Documentaciรณn**: 5 archivos completos

---

## ๐ฎ PRรXIMA VERSIรN: 0.2.0-alpha (Next.js)

### Cambios Mayores:
- โ Frontend: Next.js 14 + React 18
- โ 3D: React Three Fiber (experiencia inmersiva)
- โ Animaciones: Framer Motion + GSAP
- โ UI: Shadcn/ui (componentes beautiful)
- โ Interfaz รบnica: Scroll continuo sin navegaciรณn
- โ Audio: Tone.js (frecuencias generativas)

### Sin Cambios:
- โ Backend Python/FastAPI (se mantiene)
- โ Toda la lรณgica de agentes (se mantiene)
- โ Filosofรญa y principios (se mantiene)

---

**๐ Documentaciรณn viva. Se actualiza con el organismo.**

**ููุง ุดูุงุกู ูฑูููููฐูู**

