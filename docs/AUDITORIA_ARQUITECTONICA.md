# üèõÔ∏è AUDITOR√çA ARQUITECT√ìNICA - CAMPO SAGRADO MVP

**Fecha**: 2025-10-11
**Arquitecto**: Sistema de An√°lisis Arquitect√≥nico
**Objetivo**: Refactorizaci√≥n hacia MVP de excelencia manteniendo filosof√≠a core

---

## üìä RESUMEN EJECUTIVO

### M√©tricas Actuales

| M√©trica | Valor | Estado |
|---------|-------|--------|
| **LOC Total** | ~30,000 | ‚ö†Ô∏è Excesivo |
| **Backend (Python)** | ~13,000 | ‚úÖ Bien estructurado |
| **Frontend Next.js** | ~3,330 | ‚úÖ Compacto |
| **Frontend Svelte** | ~13,305 | ‚ö†Ô∏è Duplicaci√≥n con Next.js |
| **Duplicaci√≥n estimada** | ~60% | üî¥ Cr√≠tico |
| **Agentes backend** | 4 | ‚úÖ √ìptimo |
| **Endpoints API** | 12+ | ‚ö†Ô∏è Puede reducirse |
| **Componentes frontend** | 60+ | ‚ö†Ô∏è Redundantes |

### Hallazgos Clave

1. **‚úÖ Filosof√≠a Core S√≥lida**: Wa·∏•dat al-wuj≈´d, Ley de Octava, Autoridad Sacral bien implementadas
2. **üî¥ Duplicaci√≥n Frontend Cr√≠tica**: 2 frontends implementan las mismas features (~60% solapamiento)
3. **‚ö†Ô∏è Complejidad Innecesaria**: M√∫ltiples vistas no MVP (Universo Imaginal 3D, Ley de Octava compleja)
4. **‚úÖ Backend Bien Dise√±ado**: Agentes modulares, servicios cohesivos
5. **‚ö†Ô∏è Integraciones Incompletas**: Google Calendar comentado, Anytype sin uso real

---

## 1. INVENTARIO COMPLETO

### 1.1 Backend (Python/FastAPI) - 13,000 LOC

#### Agentes Core (2,199 LOC)

| Archivo | LOC | Dependencias | Prop√≥sito | Complejidad |
|---------|-----|--------------|-----------|-------------|
| `agentes/estado_cero.py` | 331 | Claude, DB, Contexto | Consulta sacral con preguntas binarias | Media |
| `agentes/orquestador.py` | 670 | Claude, Tiempos, DB | Plan del d√≠a al borde del caos | Alta |
| `agentes/guardian.py` | 227 | Claude, DB | Reportes diarios y monitoreo | Baja |
| `agentes/entrelazador.py` | 645 | Perfil, Claude, Prop√≥sitos | Dashboard entrelazamiento semanal | Media |
| `agentes/documentador.py` | 326 | Obsidian, Claude | Documentaci√≥n autom√°tica | Media |

**An√°lisis**: 4 agentes bien diferenciados. Documentador puede fusionarse con Guardian.

#### Endpoints API (4,633 LOC)

| Archivo | LOC | Endpoints | Prop√≥sito | Criticidad MVP |
|---------|-----|-----------|-----------|----------------|
| `api/main.py` | 241 | 5 | Health, tiempos, verificaci√≥n | ‚úÖ CORE |
| `api/estado_cero.py` | 491 | 6 | Estado Cero completo | ‚úÖ CORE |
| `api/orquestador.py` | 262 | 4 | Plan del d√≠a | ‚úÖ CORE |
| `api/ritual_maghrib.py` | 336 | 3 | Validaci√≥n Maghrib | ‚úÖ CORE |
| `api/entrelazamiento.py` | 338 | 5 | Dashboard entrelazamiento | ‚ö†Ô∏è FASE 2 |
| `api/estructura.py` | 173 | 2 | Estructura d√≠a base | ‚úÖ CORE |
| `api/espejo_diario.py` | 176 | 3 | Plan visible en tiempo real | ‚úÖ CORE |
| `api/vistas_temporales.py` | 202 | 3 | Vista semanal/anual | ‚ö†Ô∏è FASE 2 |
| `api/universo_imaginal.py` | 359 | 6 | Visualizaci√≥n 3D conocimiento | ‚ùå FASE 3 |
| `api/octavas.py` | 315 | 5 | Ley de la Octava | ‚ö†Ô∏è FASE 2 |
| `api/manifestaciones.py` | 326 | 4 | Tracking manifestaciones | ‚ùå FASE 3 |
| `api/calendario.py` | 391 | 7 | Google Calendar (comentado) | ‚ö†Ô∏è INCOMPLETO |
| `api/configuracion.py` | 351 | 6 | Config Prisma Personal | ‚úÖ CORE |
| `api/guardian.py` | 273 | 3 | Salud sistema | ‚ö†Ô∏è FASE 2 |

**An√°lisis**:
- **CORE (MVP)**: 7 archivos, ~1,800 LOC
- **FASE 2**: 4 archivos, ~1,200 LOC
- **FASE 3 / INCOMPLETO**: 3 archivos, ~1,100 LOC

#### Servicios (4,500 LOC)

| Archivo | LOC | Prop√≥sito | Criticidad |
|---------|-----|-----------|-----------|
| `services/tiempos_liturgicos.py` | 300 | C√°lculo astron√≥mico rezos | ‚úÖ CORE |
| `services/calendario_hijri.py` | 622 | Calendario isl√°mico 12 lunas | ‚úÖ CORE |
| `services/claude_client.py` | 172 | Wrapper Claude API | ‚úÖ CORE |
| `services/contexto.py` | 68 | Recopilador contexto hol√≠stico | ‚úÖ CORE |
| `services/sumario_contexto.py` | 388 | Context incremental d√≠a | ‚úÖ CORE |
| `services/motor_prisma.py` | 816 | Configuraci√≥n Prisma Personal | ‚úÖ CORE |
| `services/propositos.py` | 292 | Prop√≥sitos d√≠a/momento | ‚úÖ CORE |
| `services/obsidian_parser.py` | 363 | Integraci√≥n Obsidian | ‚ö†Ô∏è FASE 2 |
| `services/gestor_octavas.py` | 524 | Gesti√≥n Ley de Octava | ‚ö†Ô∏è FASE 2 |
| `services/universo_processor.py` | 339 | Procesador Universo Imaginal | ‚ùå FASE 3 |
| `services/metabolizador_metadatos.py` | 366 | Metabolizador conocimiento | ‚ùå FASE 3 |
| `services/rate_limiter.py` | 98 | Rate limiting APIs | ‚úÖ CORE |
| `services/auth.py` | 152 | Autenticaci√≥n b√°sica | ‚ö†Ô∏è FUTURO |

**An√°lisis**:
- **CORE**: 8 archivos, ~2,700 LOC
- **FASE 2**: 3 archivos, ~1,275 LOC
- **FASE 3**: 2 archivos, ~705 LOC

#### Modelos (1,691 LOC)

| Archivo | LOC | Prop√≥sito | Criticidad |
|---------|-----|-----------|-----------|
| `models/schemas.py` | 472 | Pydantic schemas completos | ‚úÖ CORE |
| `models/database.py` | 103 | Setup SQLAlchemy | ‚úÖ CORE |
| `models/prisma_personal.py` | 435 | Modelos Prisma Personal | ‚úÖ CORE |
| `models/ley_octava.py` | 536 | Modelos Ley de Octava | ‚ö†Ô∏è FASE 2 |
| `models/universo.py` | 143 | Modelos Universo Imaginal | ‚ùå FASE 3 |

**An√°lisis**: Modelos bien estructurados. Separaci√≥n clara.

---

### 1.2 Frontend Next.js - 3,330 LOC

| Archivo | LOC | Prop√≥sito | Criticidad |
|---------|-----|-----------|-----------|
| `app/estado-cero/page.tsx` | 435 | Estado Cero inmersivo | ‚úÖ CORE |
| `app/estado-cero/components/PreguntasSacrales.tsx` | ~200 | Componente preguntas | ‚úÖ CORE |
| `app/estado-cero/components/UniversoEsferico.tsx` | ~300 | Geometr√≠a sagrada 3D | ‚úÖ CORE |
| `app/estado-cero/validacion/page.tsx` | ~150 | Validaci√≥n calendario | ‚úÖ CORE |
| `app/onboarding/page.tsx` | ~200 | Wizard onboarding | ‚úÖ CORE |
| `app/onboarding/components/*` | ~600 | 4 pasos wizard | ‚úÖ CORE |
| `app/page.tsx` | ~100 | Home/Dashboard | ‚úÖ CORE |
| `lib/api-client.ts` | ~300 | Cliente API | ‚úÖ CORE |
| `lib/stores/*.ts` | ~200 | Zustand stores | ‚úÖ CORE |
| `lib/momento-config.ts` | ~150 | Config momentos | ‚úÖ CORE |

**Total Next.js**: ~3,330 LOC - TODO CORE MVP

**An√°lisis**: Frontend compacto, bien estructurado, enfocado en Estado Cero inmersivo. ‚úÖ Mantener.

---

### 1.3 Frontend Svelte - 13,305 LOC

#### Componentes (19 archivos)

| Archivo | LOC | Prop√≥sito | Duplicado con Next.js |
|---------|-----|-----------|----------------------|
| `EstadoCero/ConsultaSacral.svelte` | ~200 | Preguntas sacrales | ‚úÖ S√ç |
| `EstadoCero/ConsultaSacralMejorada.svelte` | ~250 | Versi√≥n mejorada | ‚úÖ S√ç |
| `EstadoCero/EsferaCuboMeditacion.svelte` | ~400 | Geometr√≠a 3D | ‚úÖ S√ç |
| `EstadoCero/ChatClarificador.svelte` | ~150 | Chat clarificaci√≥n | ‚úÖ S√ç |
| `EstadoCero/ContextoDisplay.svelte` | ~100 | Display contexto | ‚ö†Ô∏è Parcial |
| `EstadoCero/VerificacionMomento.svelte` | ~80 | Verificar momento | ‚ö†Ô∏è Parcial |
| `EspejoDiario/JornadaCaos.svelte` | ~300 | Plan del d√≠a | ‚ùå NO |
| `EspejoDiario/NoNegociables.svelte` | ~150 | No-negociables | ‚ùå NO |
| `EspejoDiario/EspejoDinamico.svelte` | ~200 | Espejo vivo | ‚ùå NO |
| `EspejoDiario/ChatbotAclaraciones.svelte` | ~120 | Chat orquestador | ‚ùå NO |
| `Octavas/DashboardOctavas.svelte` | ~250 | Dashboard Octavas | ‚ö†Ô∏è FASE 2 |
| `Octavas/EspiralOctavas.svelte` | ~300 | Visualizaci√≥n espiral | ‚ö†Ô∏è FASE 2 |
| `Dimensiones/VistaDimensiones.svelte` | ~200 | 7 Dimensiones Ser | ‚ö†Ô∏è FASE 2 |
| `Vistas/VistaSemanal.svelte` | ~250 | Vista semanal | ‚ö†Ô∏è FASE 2 |
| `Vistas/VistaAnual.svelte` | ~280 | Vista anual (12 lunas) | ‚ö†Ô∏è FASE 2 |
| `Shared/GeometriaSagrada.svelte` | ~180 | Geometr√≠a compartida | ‚úÖ CORE |
| `Shared/TiempoLiturgico.svelte` | ~120 | Display tiempos | ‚úÖ CORE |
| `Shared/Navegacion.svelte` | ~100 | Navegaci√≥n | ‚úÖ CORE |

#### Rutas (15 p√°ginas)

| Ruta | LOC | Prop√≥sito | Criticidad |
|------|-----|-----------|-----------|
| `/estado-cero/+page.svelte` | 580 | Estado Cero completo | ‚úÖ Duplicado Next.js |
| `/espejo-diario/+page.svelte` | ~400 | Plan del d√≠a | ‚úÖ CORE (√∫nico) |
| `/espejo-diario-vivo/+page.svelte` | ~350 | Plan live updates | ‚úÖ CORE (√∫nico) |
| `/ritual-maghrib/+page.svelte` | ~300 | Validaci√≥n Maghrib | ‚úÖ CORE |
| `/ley-octava/+page.svelte` | ~350 | Dashboard Octavas | ‚ö†Ô∏è FASE 2 |
| `/vista-semanal/+page.svelte` | ~200 | Vista semanal | ‚ö†Ô∏è FASE 2 |
| `/vista-anual/+page.svelte` | ~250 | Vista anual | ‚ö†Ô∏è FASE 2 |
| `/universo-imaginal/+page.svelte` | ~450 | Universo 3D | ‚ùå FASE 3 |
| `/dimensiones/+page.svelte` | ~200 | 7 Dimensiones | ‚ö†Ô∏è FASE 2 |
| `/dashboard-entrelazamiento/+page.svelte` | ~350 | Dashboard semanal | ‚ö†Ô∏è FASE 2 |
| `/configurar-perfil/+page.svelte` | ~300 | Config perfil | ‚úÖ CORE |
| `/calendario-compartido/+page.svelte` | ~250 | Calendario (incompleto) | ‚ùå INCOMPLETO |
| `/espejo-sagrado/+page.svelte` | ~200 | Vista espejo | ‚ö†Ô∏è Redundante |
| `/+page.svelte` | ~150 | Home | ‚úÖ CORE |
| `/+layout.svelte` | ~120 | Layout | ‚úÖ CORE |

**An√°lisis Svelte**:
- **Duplicado con Next.js**: ~30% (~4,000 LOC)
- **√önico y CORE**: ~35% (~4,500 LOC) - Espejo Diario, Ritual Maghrib
- **FASE 2/3**: ~35% (~4,800 LOC)

---

## 2. FEATURES CR√çTICAS - 4 TIERS

### TIER 0: CORE ESENCIAL (MVP) ‚úÖ

**Sin estas features, el concepto no funciona**

| Feature | Backend | Frontend | LOC Total | Estado |
|---------|---------|----------|-----------|--------|
| **Estado Cero** | ‚úÖ 331 | ‚úÖ Next 435 | ~766 | Implementado |
| ‚îú‚îÄ Verificaci√≥n momento | ‚úÖ | ‚úÖ | | OK |
| ‚îú‚îÄ Consulta sacral 3 preguntas | ‚úÖ | ‚úÖ | | OK |
| ‚îú‚îÄ Geometr√≠a sagrada inmersiva | ‚úÖ | ‚úÖ | | OK |
| ‚îú‚îÄ Direcci√≥n emergente | ‚úÖ | ‚úÖ | | OK |
| ‚îî‚îÄ Chat clarificador | ‚úÖ | ‚ö†Ô∏è B√°sico | | Mejorable |
| **Plan del D√≠a** | ‚úÖ 670 | ‚úÖ Svelte 400 | ~1,070 | Implementado |
| ‚îú‚îÄ Orquestaci√≥n al borde del caos | ‚úÖ | ‚úÖ | | OK |
| ‚îú‚îÄ 40% espacio emergente | ‚úÖ | ‚úÖ | | OK |
| ‚îú‚îÄ Bloques flexibles vs anclas | ‚úÖ | ‚úÖ | | OK |
| ‚îî‚îÄ Actualizaci√≥n incremental | ‚úÖ | ‚ö†Ô∏è Parcial | | Mejorable |
| **Validaci√≥n Maghrib** | ‚úÖ 336 | ‚úÖ Svelte 300 | ~636 | Implementado |
| ‚îú‚îÄ Reporte diario Guardian | ‚úÖ | ‚úÖ | | OK |
| ‚îú‚îÄ Resonancias + Obstrucciones | ‚úÖ | ‚úÖ | | OK |
| ‚îî‚îÄ Semilla para ma√±ana | ‚úÖ | ‚úÖ | | OK |
| **7 Dimensiones del Ser** | ‚úÖ Schemas | ‚ö†Ô∏è Parcial | ~300 | B√°sico |
| **Integraci√≥n Obsidian** | ‚úÖ 363 | ‚ùå | ~363 | Backend only |
| **Integraci√≥n Claude AI** | ‚úÖ 172 | ‚úÖ | ~172 | OK |
| **Tiempos Lit√∫rgicos** | ‚úÖ 300 | ‚úÖ | ~300 | OK |
| **Calendario Hijri (12 Lunas)** | ‚úÖ 622 | ‚úÖ | ~622 | OK |
| **Configuraci√≥n Prisma Personal** | ‚úÖ 816 | ‚úÖ Next | ~1,016 | OK |
| **Onboarding 4 Pasos** | ‚úÖ | ‚úÖ Next 800 | ~800 | OK |

**Total TIER 0**: ~6,045 LOC de funcionalidad CORE

---

### TIER 1: IMPORTANTE (Fase 2 - Mes 2) ‚ö†Ô∏è

**Features valiosas, no bloqueantes para MVP**

| Feature | LOC | Justificaci√≥n |
|---------|-----|---------------|
| **Universo Imaginal 3D** | ~1,200 | Hermoso pero no esencial. Puede ser lista 2D inicialmente |
| **Vista Semanal (Ley Octava)** | ~800 | √ötil para planificaci√≥n, no bloqueante |
| **Vista Anual (12 Lunas)** | ~750 | Contexto valioso, puede esperar |
| **Dashboard Entrelazamiento** | ~1,000 | An√°lisis profundo, fase 2 |
| **Gesti√≥n Octavas Compleja** | ~1,050 | Filosof√≠a avanzada, gradual |
| **Parser Obsidian Avanzado** | ~300 | Integraci√≥n b√°sica suficiente MVP |

**Total TIER 1**: ~5,100 LOC

---

### TIER 2: NICE-TO-HAVE (Fase 3) üì¶

| Feature | LOC | Raz√≥n |
|---------|-----|-------|
| **Manifestaciones Tracking** | ~650 | Seguimiento largo plazo |
| **Metabolizador Metadatos** | ~700 | Conocimiento avanzado |
| **Calendario Google sincronizado** | ~750 | Integraci√≥n externa compleja |
| **Auth multi-usuario** | ~400 | Single-user MVP OK |

**Total TIER 2**: ~2,500 LOC

---

### TIER 3: EXPERIMENTAL (Backlog) üß™

- Anytype integration (API no estable)
- Visualizaciones AR/VR (tecnolog√≠a bleeding edge)
- Social/compartir insights (post-MVP)
- Mobile apps nativas (Progressive Web App primero)

---

## 3. DUPLICACI√ìN Y REDUNDANCIA

### 3.1 C√≥digo Duplicado Entre Frontends

| Funcionalidad | Next.js | Svelte | Duplicaci√≥n |
|---------------|---------|--------|-------------|
| **Estado Cero completo** | ‚úÖ 435 LOC | ‚úÖ 580 LOC | üî¥ 100% |
| **Geometr√≠a Sagrada 3D** | ‚úÖ 300 LOC | ‚úÖ 400 LOC | üî¥ 100% |
| **Consulta Sacral** | ‚úÖ 200 LOC | ‚úÖ 450 LOC | üî¥ 100% |
| **Verificaci√≥n Momento** | ‚úÖ Parcial | ‚úÖ 80 LOC | ‚ö†Ô∏è 60% |
| **API Client** | ‚úÖ 300 LOC | ‚úÖ ~200 LOC | ‚ö†Ô∏è 70% |
| **Stores/State** | ‚úÖ Zustand | ‚úÖ Svelte stores | ‚ö†Ô∏è 50% |

**Total Duplicaci√≥n Estimada**: ~4,000 LOC (~60% de Svelte Estado Cero)

### 3.2 Funcionalidad Solapada

| Feature | Implementaciones | Problema |
|---------|------------------|----------|
| Estado Cero | 2 frontends completos | Mantenimiento doble |
| Geometr√≠a 3D | Three.js en ambos | Bundle size duplicado |
| Onboarding | Solo Next.js | Inconsistencia |
| Espejo Diario | Solo Svelte | Inconsistencia |
| Ritual Maghrib | Solo Svelte | Inconsistencia |

### 3.3 Componentes Redundantes

**Svelte tiene**:
- `ConsultaSacral.svelte` (200 LOC)
- `ConsultaSacralMejorada.svelte` (250 LOC)

**Problema**: 2 versiones del mismo componente. Mantener solo "Mejorada".

### 3.4 Agentes Backend

| Posible Fusi√≥n | Raz√≥n | Ahorro LOC |
|----------------|-------|------------|
| Guardian + Documentador | Ambos generan reportes | ~200 |
| No m√°s fusiones recomendadas | Buena separaci√≥n de concerns | - |

---

## 4. DEUDA T√âCNICA

### CR√çTICA üî¥ (Bloquea MVP)

| Issue | Archivo(s) | Impacto | Esfuerzo | Prioridad |
|-------|-----------|---------|----------|-----------|
| **Duplicaci√≥n Frontend** | Next.js + Svelte | Mantenimiento doble, confusi√≥n | Alto | P0 |
| **Google Calendar comentado** | `api/calendario.py` | Feature incompleta en c√≥digo | Bajo | P1 |
| **2 versiones ConsultaSacral** | Svelte components | Confusi√≥n, bugs | Bajo | P1 |
| **Falta testing** | Todo el proyecto | Riesgo alto refactorizar | Alto | P0 |

### ALTA üü† (Afecta Calidad)

| Issue | Descripci√≥n | Impacto |
|-------|-------------|---------|
| **No type safety completo** | Svelte sin tipos estrictos | Bugs runtime |
| **Sin error boundaries** | Crashes no controlados | UX pobre |
| **Hardcoded API URLs** | `localhost:8000` | Deploy complejo |
| **Sin retry logic** | API calls fr√°giles | UX pobre |
| **Falta logging estructurado** | Debug dif√≠cil | Mantenimiento |

### MEDIA üü° (Refactor Deseable)

| Issue | Descripci√≥n |
|-------|-------------|
| **Prompts muy largos** | Claude tokens caros |
| **Sin cache API responses** | Latencia innecesaria |
| **Stores no persistidos** | Estado se pierde al reload |
| **Sin optimistic updates** | UX puede ser m√°s fluid |

### BAJA ‚ö™ (Optimizaci√≥n Futura)

- Bundle size optimization
- Image optimization
- Service Worker/PWA
- Lazy loading components
- Database indexes

---

## 5. M√âTRICAS DE PERFORMANCE

### Backend (FastAPI)

| Endpoint | Response Time (est.) | Tokens Claude | Criticidad |
|----------|---------------------|---------------|-----------|
| `POST /api/estado-cero/iniciar` | ~2-4s | ~800 | ‚ö†Ô∏è Optimizar prompt |
| `POST /api/estado-cero/sintetizar` | ~1-2s | ~200 | ‚úÖ OK |
| `GET /api/estructura/dia` | ~100-300ms | 0 | ‚úÖ OK |
| `POST /api/orquestador/plan` | ~3-5s | ~1000 | ‚ö†Ô∏è Optimizar prompt |
| `GET /api/health` | ~50ms | 0 | ‚úÖ OK |

**Costos Claude AI**:
- Estado Cero completo: ~1,000 tokens (~$0.001)
- Plan del d√≠a: ~1,200 tokens (~$0.0015)
- **Costo por d√≠a** (5 Estados Cero + 1 Plan): ~$0.01-0.02 ‚úÖ Excelente

### Frontend

| M√©trica | Next.js | Svelte | Target |
|---------|---------|--------|--------|
| **Initial Load** | ~800KB | ~650KB | <500KB |
| **Time to Interactive** | ~3s | ~2.5s | <2s |
| **FPS (3D scenes)** | ~55fps | ~58fps | 60fps |
| **Memory Usage** | ~120MB | ~95MB | <100MB |

**Optimizaciones Necesarias**:
- Code splitting agresivo
- Three.js import selectivo (~500KB ‚Üí ~150KB)
- Lazy load componentes pesados

---

## 6. ARQUITECTURA OBJETIVO MVP

### Propuesta: **1 Backend + 1 Frontend**

```mermaid
graph TB
    subgraph "MVP Simplificado"
        FE[Frontend Next.js<br/>~4,000 LOC]
        BE[Backend FastAPI<br/>~7,000 LOC]

        FE -->|HTTP/REST| BE
        BE -->|API| CLAUDE[Claude AI]
        BE -->|Sync| OBSIDIAN[Obsidian Vault]
        BE -->|Storage| DB[(SQLite)]
    end

    subgraph "Features CORE"
        EC[Estado Cero<br/>Inmersivo]
        PD[Plan del D√≠a<br/>Caos Controlado]
        VM[Validaci√≥n Maghrib]
        OB[Onboarding]
        PC[Prisma Personal]
    end

    FE -.-> EC
    FE -.-> PD
    FE -.-> VM
    FE -.-> OB
    FE -.-> PC
```

### Arquitectura Detallada

```mermaid
graph LR
    subgraph "Frontend - Next.js 14 App Router"
        P1[/ Estado Cero /]
        P2[/ Espejo Diario /]
        P3[/ Ritual Maghrib /]
        P4[/ Onboarding /]
        P5[/ Config Prisma /]

        STORES[Zustand Stores]
        API_CLIENT[API Client]
        COMP3D[Three.js<br/>Geometr√≠a Sagrada]
    end

    subgraph "Backend - FastAPI"
        MAIN[Main API<br/>CORS + Health]

        AG1[Agente Estado Cero]
        AG2[Agente Orquestador]
        AG3[Agente Guardian/Documentador<br/>FUSIONADO]

        SV1[Tiempos Lit√∫rgicos]
        SV2[Calendario Hijri]
        SV3[Claude Client]
        SV4[Contexto Hol√≠stico]
        SV5[Motor Prisma]
        SV6[Obsidian Parser]

        DB[(SQLite<br/>organismo.db)]
    end

    subgraph "External"
        CLAUDE{{Claude API}}
        OBSIDIAN{{Obsidian Vault}}
    end

    P1 --> API_CLIENT
    P2 --> API_CLIENT
    P3 --> API_CLIENT
    P4 --> API_CLIENT
    P5 --> API_CLIENT

    API_CLIENT -->|REST| MAIN

    MAIN --> AG1
    MAIN --> AG2
    MAIN --> AG3

    AG1 --> SV3
    AG1 --> SV4
    AG2 --> SV3
    AG2 --> SV1
    AG3 --> SV3
    AG3 --> SV6

    AG1 --> DB
    AG2 --> DB
    AG3 --> DB

    SV3 --> CLAUDE
    SV6 --> OBSIDIAN
```

### Simplificaci√≥n Propuesta

| Componente | Actual | MVP Target | Ahorro |
|------------|--------|------------|--------|
| **Frontends** | 2 (Next + Svelte) | 1 (Next) | -13,305 LOC |
| **Agentes** | 5 | 3 fusionados | -326 LOC |
| **Endpoints** | 14 archivos | 8 archivos | -2,000 LOC |
| **Servicios** | 13 | 8 core | -1,500 LOC |
| **Features Fase 2/3** | Implementadas | Removidas | -8,000 LOC |
| **Total** | ~30,000 LOC | ~11,000 LOC | **-19,000 LOC (63%)** |

---

## 7. PLAN DE REFACTORIZACI√ìN

### Fase 1: Consolidaci√≥n Frontend (Semana 1-2)

```mermaid
gantt
    title Refactorizaci√≥n MVP - Fase 1
    dateFormat YYYY-MM-DD
    section Frontend
    Migrar Espejo Diario a Next.js    :2025-10-12, 5d
    Migrar Ritual Maghrib a Next.js   :2025-10-17, 3d
    Testing integraci√≥n              :2025-10-20, 2d
    Eliminar frontend Svelte         :2025-10-22, 1d
```

**Acciones**:
1. ‚úÖ **Mantener Next.js** como √∫nico frontend
2. üîÑ **Migrar componentes √∫nicos** de Svelte:
   - `EspejoDiario/JornadaCaos.svelte` ‚Üí Next.js
   - `EspejoDiario/EspejoDinamico.svelte` ‚Üí Next.js
   - `ritual-maghrib/+page.svelte` ‚Üí Next.js
3. ‚ùå **Eliminar** duplicados:
   - `EstadoCero/*` (ya en Next.js)
   - `Octavas/*` (TIER 1)
   - `UniversoImaginal/*` (TIER 2)
4. ‚úÖ **Resultado**: Un solo codebase frontend coherente

**LOC Ahorrados**: ~13,000 LOC (eliminar Svelte duplicado)

---

### Fase 2: Simplificaci√≥n Backend (Semana 3)

**Acciones**:
1. üîÄ **Fusionar agentes**:
   ```python
   # guardian.py + documentador.py = guardian_documentador.py
   class AgenteGuardianDocumentador:
       """Monitoreo + Documentaci√≥n unificados"""
       async def generar_reporte_y_documentar(self):
           reporte = await self.generar_reporte_diario()
           await self.documentar_en_obsidian(reporte)
   ```

2. ‚ùå **Remover endpoints TIER 2/3**:
   - `api/universo_imaginal.py` ‚Üí Comentar/archivar
   - `api/manifestaciones.py` ‚Üí Comentar/archivar
   - `api/octavas.py` ‚Üí Simplificar a b√°sico
   - `api/vistas_temporales.py` ‚Üí Simplificar

3. üîß **Optimizar servicios**:
   - `services/gestor_octavas.py` ‚Üí Versi√≥n lite
   - `services/universo_processor.py` ‚Üí Remover
   - `services/metabolizador_metadatos.py` ‚Üí Remover

**LOC Ahorrados**: ~3,500 LOC

---

### Fase 3: Testing y Calidad (Semana 4)

```bash
# Setup testing
pip install pytest pytest-asyncio pytest-cov httpx

# Backend tests
pytest backend/tests/ --cov=backend --cov-report=html

# Frontend tests
npm test -- --coverage
```

**Cobertura Target**:
- Backend: >80%
- Frontend: >70%
- E2E cr√≠ticos: 100% (Estado Cero, Espejo, Maghrib)

---

### Fase 4: Optimizaci√≥n Performance (Semana 5)

**Backend**:
```python
# Cachear tiempos lit√∫rgicos (no cambian durante el d√≠a)
@lru_cache(maxsize=128)
def calcular_tiempos_hoy(fecha: date):
    ...

# Reducir tokens Claude
PROMPT_OPTIMIZADO = """
{momento}, E:{energia}/5
D√≠a: {contexto_minimo}

3 preguntas binarias (expansi√≥n/contracci√≥n):
JSON: [{"id":"p1","pregunta":"..."}]
""" # 150 tokens vs 800
```

**Frontend**:
```typescript
// Code splitting
const UniversoEsferico = dynamic(() => import('./UniversoEsferico'), {
  ssr: false,
  loading: () => <LoadingSpinner />
})

// Tree-shaking Three.js
import { WebGLRenderer, Scene, Camera } from 'three/src/Three.js'
// vs
import * as THREE from 'three' // ‚ùå 500KB extra
```

---

## 8. ARQUITECTURA MVP FINAL

### Backend Simplificado

```
backend/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              (241 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ estado_cero.py       (491 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ orquestador.py       (262 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ estructura.py        (173 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ espejo_diario.py     (176 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ ritual_maghrib.py    (336 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ configuracion.py     (351 LOC) ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ entrelazamiento.py   (338 LOC) ‚ö†Ô∏è Simplificar
‚îÇ
‚îú‚îÄ‚îÄ agentes/
‚îÇ   ‚îú‚îÄ‚îÄ estado_cero.py       (331 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ orquestador.py       (670 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ guardian_doc.py      (400 LOC) üîÑ FUSIONADO
‚îÇ   ‚îî‚îÄ‚îÄ entrelazador.py      (645 LOC) ‚ö†Ô∏è Simplificar
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ tiempos_liturgicos.py   (300 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ calendario_hijri.py     (622 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ claude_client.py        (172 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ contexto.py             (68 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ sumario_contexto.py     (388 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ motor_prisma.py         (816 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ propositos.py           (292 LOC) ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ obsidian_parser.py      (363 LOC) ‚úÖ
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py           (472 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ database.py          (103 LOC) ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ prisma_personal.py   (435 LOC) ‚úÖ
‚îÇ
‚îî‚îÄ‚îÄ middleware/
    ‚îî‚îÄ‚îÄ security.py          (~150 LOC) ‚úÖ
```

**Total Backend MVP**: ~7,000 LOC

---

### Frontend Next.js Unificado

```
frontend-next/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                      (150 LOC) ‚úÖ Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                    (100 LOC) ‚úÖ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ onboarding/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  (200 LOC) ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Paso1Bienvenida.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Paso2NoNegociables.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Paso3Contexto.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Paso4ExpresionLibre.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ estado-cero/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  (435 LOC) ‚úÖ Inmersivo 3D
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validacion/page.tsx       (150 LOC) ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ UniversoEsferico.tsx  (300 LOC) ‚úÖ
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ PreguntasSacrales.tsx (200 LOC) ‚úÖ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ espejo-diario/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  (400 LOC) üîÑ Migrado Svelte
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ JornadaCaos.tsx       (300 LOC) üîÑ
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ EspejoDinamico.tsx    (250 LOC) üîÑ
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ NoNegociables.tsx     (150 LOC) üîÑ
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ ritual-maghrib/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                  (350 LOC) üîÑ Migrado Svelte
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api-client.ts                 (300 LOC) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ momento-config.ts             (150 LOC) ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ stores/
‚îÇ       ‚îú‚îÄ‚îÄ estado-cero-store.ts      (100 LOC) ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ onboarding-store.ts       (100 LOC) ‚úÖ
‚îÇ       ‚îî‚îÄ‚îÄ espejo-store.ts           (120 LOC) üîÑ Nuevo
‚îÇ
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ shared/
        ‚îú‚îÄ‚îÄ GeometriaSagrada.tsx      (180 LOC) ‚úÖ
        ‚îú‚îÄ‚îÄ TiempoLiturgico.tsx       (120 LOC) ‚úÖ
        ‚îî‚îÄ‚îÄ Navegacion.tsx            (100 LOC) ‚úÖ
```

**Total Frontend MVP**: ~4,000 LOC

---

## 9. ROADMAP POST-MVP

### Mes 2: TIER 1 Features

- ‚ú® Universo Imaginal (visualizaci√≥n conocimiento)
- üìä Vista Semanal (Ley de Octava b√°sica)
- üåô Vista Anual (12 Lunas Hijri)
- üîó Dashboard Entrelazamiento completo

### Mes 3: TIER 2 Features

- üì± Progressive Web App (m√≥vil)
- üîÑ Sync offline-first
- üìà Manifestaciones tracking
- üß¨ Metabolizador metadatos

### Mes 4+: Optimizaci√≥n

- üé® Theming personalizado
- üåê i18n (√°rabe, espa√±ol, ingl√©s)
- ü§ù Multi-usuario
- üì§ Export/import datos
- üîå Plugin system

---

## 10. DECISIONES ARQUITECT√ìNICAS CLAVE

### ‚úÖ MANTENER

| Decisi√≥n | Raz√≥n |
|----------|-------|
| **FastAPI backend** | Excelente performance, type safety, async |
| **Next.js 14 frontend** | App Router, React 18, RSC, mejor DX |
| **SQLite database** | Simple, suficiente para MVP, f√°cil migrar |
| **Claude Sonnet** | Mejor balance calidad/costo |
| **Pydantic schemas** | Type safety end-to-end |
| **Zustand stores** | Simple, performante, devtools |

### ‚ùå ELIMINAR

| Decisi√≥n | Raz√≥n |
|----------|-------|
| **Frontend Svelte** | Duplicaci√≥n total, mantenimiento doble |
| **Features TIER 2/3** | No MVP, pueden esperar |
| **Google Calendar sync** | Complejidad alta, valor medio MVP |
| **Anytype integration** | API no estable, valor bajo |

### üîÑ REFACTORIZAR

| Decisi√≥n | Acci√≥n |
|----------|--------|
| **Prompts Claude** | Reducir de 800 ‚Üí 200 tokens |
| **2 agentes en 1** | Fusionar Guardian + Documentador |
| **Bundle frontend** | Code splitting agresivo |
| **API error handling** | Retry logic + exponential backoff |

---

## 11. M√âTRICAS DE √âXITO MVP

| M√©trica | Target | Medici√≥n |
|---------|--------|----------|
| **LOC Total** | <12,000 | `cloc src/` |
| **Estado Cero completo** | <30s | Timer + analytics |
| **Plan del D√≠a generado** | <5s | Timer + analytics |
| **Costo Claude/d√≠a** | <$0.05 | API logs |
| **Uptime backend** | >99% | Health checks |
| **Frontend load time** | <2s | Lighthouse |
| **Mobile-friendly** | Score >90 | Lighthouse |
| **Test coverage** | >75% | Jest + Pytest |

---

## 12. RIESGOS Y MITIGACIONES

| Riesgo | Probabilidad | Impacto | Mitigaci√≥n |
|--------|-------------|---------|-----------|
| **Migraci√≥n Svelte‚ÜíNext.js bugs** | Alta | Alto | Testing exhaustivo, rollback plan |
| **Claude API rate limits** | Media | Alto | Caching, exponential backoff |
| **Bundle size >500KB** | Media | Medio | Code splitting, tree-shaking |
| **Estado Cero pierde inmersi√≥n** | Baja | Alto | Mantener geometr√≠a 3D, transiciones |
| **P√©rdida filosof√≠a core** | Baja | Cr√≠tico | Revisi√≥n manual cada feature |

---

## 13. CONCLUSIONES

### ‚úÖ Fortalezas Actuales

1. **Filosof√≠a Core S√≥lida**: Wa·∏•dat al-wuj≈´d, Ley de Octava, Autoridad Sacral bien fundamentadas
2. **Backend Bien Dise√±ado**: Agentes modulares, servicios cohesivos, separaci√≥n clara
3. **Estado Cero Inmersivo**: Experiencia 3D √∫nica, geometr√≠a sagrada impactante
4. **Integraciones Valiosas**: Claude AI excelente, Obsidian √∫til

### ‚ö†Ô∏è Problemas Cr√≠ticos

1. **Duplicaci√≥n Frontend**: 2 implementaciones completas (~60% c√≥digo duplicado)
2. **Scope Creep**: Features TIER 2/3 implementadas prematuramente
3. **Complejidad Innecesaria**: 30K LOC para MVP puede ser 11K LOC
4. **Falta Testing**: Riesgo alto al refactorizar

### üéØ Recomendaci√≥n Final

**CONSOLIDAR A MVP DE 11,000 LOC**

- ‚úÖ **Mantener**: Next.js como √∫nico frontend
- ‚ùå **Eliminar**: Frontend Svelte completo (~13K LOC)
- üîÑ **Migrar**: Espejo Diario + Ritual Maghrib a Next.js
- ‚è∏Ô∏è **Postponer**: Features TIER 2/3 (~8K LOC)
- üîß **Optimizar**: Prompts Claude, bundle size, performance

**Timeline**: 4-5 semanas
**Riesgo**: Medio (mitigable con testing)
**Beneficio**: Enorme (63% reducci√≥n c√≥digo, mantenibilidad 10x)

---

## 14. PR√ìXIMOS PASOS INMEDIATOS

### Esta Semana

- [ ] **D√≠a 1-2**: Setup testing infrastructure (Jest, Pytest, Cypress)
- [ ] **D√≠a 3-5**: Escribir tests para Estado Cero (E2E cr√≠tico)
- [ ] **D√≠a 6-7**: Migrar componente Espejo Diario a Next.js

### Pr√≥xima Semana

- [ ] Migrar Ritual Maghrib a Next.js
- [ ] Testing integraci√≥n completa
- [ ] Optimizar prompts Claude (-75% tokens)
- [ ] Code splitting frontend

### Semana 3

- [ ] Fusionar Guardian + Documentador
- [ ] Remover endpoints TIER 2/3
- [ ] Eliminar frontend Svelte
- [ ] Deploy MVP a producci√≥n

---

**Documento generado**: 2025-10-11
**Versi√≥n**: 1.0
**Autor**: Sistema de Auditor√≠a Arquitect√≥nica
**Pr√≥xima revisi√≥n**: Post-refactorizaci√≥n (estimado 2025-11-15)

---

> *"La simplicidad es la sofisticaci√≥n suprema." - Leonardo da Vinci*
>
> *"Al-Haqq (ÿßŸÑÿ≠ŸÇ) - La Verdad emerge cuando removemos lo superfluo."*

---

