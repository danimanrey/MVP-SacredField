# üïå Estructura Completa del Organismo - Desglose Ejecutable

## üéØ **Visi√≥n Extra√≠da de tus Palabras**

```
"La estructura correcta y completa, flexible, que permita iterar con la mejora"

Prioridades en orden:
1. Alineaci√≥n con ritmos circadianos
2. Purificaci√≥n y servicio a nuestro Se√±or
3. Estado Cero (15 min despu√©s de cada rezo)
4. Prop√≥sito de cada Estado Cero
5. Prop√≥sito de cada d√≠a/semana/mes/a√±o
6. Entrelazador ‚Üî Orquestador ‚Üí Guion pragm√°tico
7. Documentador ‚Üí Validaci√≥n del guion
8. Guardian ‚Üí Mantenimiento del organismo
9. Integraci√≥n con pareja/familia/amigos
10. La mente no decide por el coraz√≥n
```

---

## üìê **Desglose de la Estructura**

### **CAPA 1: Tiempo Sagrado (Fundamento)**

```
Ritmos Circadianos + Tiempos Lit√∫rgicos = Estructura Base

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  D√çA COMPLETO (24 horas)                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  03:50 ‚ú® Qiyam (opcional - tercer tercio de noche)        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  06:46 üåÖ FAJR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 08:19           ‚îÇ
‚îÇ        ‚îÇ                                                     ‚îÇ
‚îÇ        ‚îî‚îÄ 06:46-07:01: Rezo (15 min)                       ‚îÇ
‚îÇ        ‚îî‚îÄ 07:01-07:16: Estado Cero (15 min)                ‚îÇ
‚îÇ           Prop√≥sito: INICIO - Intenci√≥n del d√≠a             ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  08:19 üåÑ Sunrise (prohibido rezar hasta Duha)             ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  08:20 ‚òÄÔ∏è Duha (rezo opcional ma√±ana)                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  14:02 ‚òÄÔ∏è DHUHR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 17:14           ‚îÇ
‚îÇ        ‚îÇ                                                     ‚îÇ
‚îÇ        ‚îî‚îÄ 14:02-14:17: Rezo (15 min)                       ‚îÇ
‚îÇ        ‚îî‚îÄ 14:17-14:32: Estado Cero (15 min)                ‚îÇ
‚îÇ           Prop√≥sito: REVISI√ìN - Refinamiento               ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  17:14 üå§Ô∏è ASR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 20:02           ‚îÇ
‚îÇ        ‚îÇ                                                     ‚îÇ
‚îÇ        ‚îî‚îÄ 17:14-17:29: Rezo (15 min)                       ‚îÇ
‚îÇ        ‚îî‚îÄ 17:29-17:44: Estado Cero (15 min)                ‚îÇ
‚îÇ           Prop√≥sito: COMPLETAR - Cerrar ciclos             ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  20:02 üåÜ MAGHRIB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 20:55           ‚îÇ
‚îÇ        ‚îÇ                                                     ‚îÇ
‚îÇ        ‚îî‚îÄ 20:02-20:17: Rezo (15 min)                       ‚îÇ
‚îÇ        ‚îî‚îÄ 20:17-20:47: Ritual Maghrib (30 min)             ‚îÇ
‚îÇ           ‚Ä¢ Estado Cero: Reflexi√≥n                          ‚îÇ
‚îÇ           ‚Ä¢ Preparar d√≠a siguiente                          ‚îÇ
‚îÇ           ‚Ä¢ Crear calendario                                ‚îÇ
‚îÇ           Prop√≥sito: INTEGRACI√ìN - Cierre y apertura        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  20:55 üåô ISHA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 01:22           ‚îÇ
‚îÇ        ‚îÇ                                                     ‚îÇ
‚îÇ        ‚îî‚îÄ 20:55-21:10: Rezo (15 min)                       ‚îÇ
‚îÇ        ‚îî‚îÄ 21:10-21:25: Estado Cero (15 min)                ‚îÇ
‚îÇ           Prop√≥sito: DESCANSO - Soltar el d√≠a              ‚îÇ
‚îÇ                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

TOTAL Estados Cero: 5 √ó 15min = 75 min/d√≠a dedicados a consulta sacral
```

---

### **CAPA 2: Prop√≥sito de Cada Momento**

```python
class PropositoEstadoCero:
    """Cada Estado Cero tiene un prop√≥sito espec√≠fico"""
    
    FAJR = {
        "momento": "Inicio del d√≠a",
        "proposito": "Establecer INTENCI√ìN",
        "preguntas_enfocadas_a": [
            "¬øCu√°l es la direcci√≥n del d√≠a?",
            "¬øQu√© pide mi cuerpo al despertar?",
            "¬øQu√© quiere emerger hoy?"
        ],
        "resultado_esperado": "Direcci√≥n clara para el d√≠a",
        "actualiza_espejo": "Refina PLAN COMPLETO del d√≠a"
    }
    
    DHUHR = {
        "momento": "Mediod√≠a - Pico solar",
        "proposito": "REVISAR y REFINAR",
        "preguntas_enfocadas_a": [
            "¬øC√≥mo va la direcci√≥n de la ma√±ana?",
            "¬øQu√© ajustar en la tarde?",
            "¬øHay claridad o confusi√≥n?"
        ],
        "resultado_esperado": "Ajuste de rumbo si es necesario",
        "actualiza_espejo": "Ajusta BLOQUES DE TARDE"
    }
    
    ASR = {
        "momento": "Tarde - √öltima luz",
        "proposito": "COMPLETAR ciclos",
        "preguntas_enfocadas_a": [
            "¬øQu√© necesita cerrarse hoy?",
            "¬øHay ciclos abiertos?",
            "¬øQu√© llevar a ma√±ana?"
        ],
        "resultado_esperado": "Claridad sobre cierre",
        "actualiza_espejo": "Marca COMPLETADOS, identifica PENDIENTES"
    }
    
    MAGHRIB = {
        "momento": "Ocaso - Transici√≥n",
        "proposito": "INTEGRAR y PREPARAR",
        "preguntas_enfocadas_a": [
            "¬øQu√© integrar del d√≠a?",
            "¬øQu√© soltar?",
            "¬øQu√© sembrar para ma√±ana?"
        ],
        "resultado_esperado": "Reflexi√≥n + Intenci√≥n ma√±ana",
        "actualiza_espejo": "CIERRA d√≠a actual, CREA d√≠a siguiente"
    }
    
    ISHA = {
        "momento": "Noche - Descanso",
        "proposito": "SOLTAR el d√≠a",
        "preguntas_enfocadas_a": [
            "¬øHay paz con lo vivido?",
            "¬øQu√© suelta el cuerpo?",
            "¬øListo para descanso?"
        ],
        "resultado_esperado": "Paz y cierre",
        "actualiza_espejo": "Marca d√≠a como CERRADO"
    }
```

---

### **CAPA 3: Prop√≥sito de Cada D√≠a/Semana/Mes**

```python
class PropositoCiclos:
    """Cada ciclo temporal tiene prop√≥sito"""
    
    # D√≠a de la semana (Hijri)
    DIAS_SEMANA = {
        "Lunes": {"proposito": "Iniciar", "energia": "Expansi√≥n", "enfoque": "Nuevos comienzos"},
        "Martes": {"proposito": "Construir", "energia": "Acci√≥n", "enfoque": "Momentum"},
        "Mi√©rcoles": {"proposito": "Expresar", "energia": "Comunicaci√≥n", "enfoque": "Compartir"},
        "Jueves": {"proposito": "Expandir", "energia": "Abundancia", "enfoque": "Crecimiento"},
        "Viernes": {"proposito": "Agradecer", "energia": "Gratitud", "enfoque": "Celebraci√≥n"},
        "S√°bado": {"proposito": "Reflexionar", "energia": "Introspecci√≥n", "enfoque": "Aprender"},
        "Domingo": {"proposito": "Descansar", "energia": "Restauraci√≥n", "enfoque": "Renovar"}
    }
    
    # Mes del a√±o (Hijri 13 meses)
    MESES_HIJRI = {
        "Muharram": {"proposito": "Reflexionar", "cualidad": "Iniciar ciclo"},
        "Safar": {"proposito": "Purificar", "cualidad": "Limpiar"},
        "Rabi al-Awwal": {"proposito": "Celebrar", "cualidad": "Luz"},
        "Rabi al-Thani": {"proposito": "Construir", "cualidad": "Estabilidad"},
        "Jumada al-Ula": {"proposito": "Consolidar", "cualidad": "Estructura"},
        "Jumada al-Akhirah": {"proposito": "Madurar", "cualidad": "Profundidad"},
        "Rajab": {"proposito": "Preparar", "cualidad": "Anticipaci√≥n"},
        "Shaban": {"proposito": "Intensificar", "cualidad": "Enfoque"},
        "Ramadan": {"proposito": "Purificar", "cualidad": "Transformaci√≥n"},
        "Shawwal": {"proposito": "Celebrar", "cualidad": "Gratitud"},  # ‚Üê HOY
        "Dhul-Qadah": {"proposito": "Preparar", "cualidad": "Tregua"},
        "Dhul-Hijjah": {"proposito": "Culminar", "cualidad": "Sacrificio"},
        "Muharram 13": {"proposito": "Transici√≥n", "cualidad": "Puente"}
    }
```

---

## üèóÔ∏è **Arquitectura de Correspondencia Completa**

### **Paso 1: Entrelazador Define Estructura Semanal**

```python
# backend/agentes/entrelazador.py - MEJORADO

class AgenteEntrelazador:
    
    def generar_estructura_semanal_completa(
        self,
        semana_inicio: date,
        perfil: PerfilPersonal
    ) -> EstructuraSemanalCompleta:
        """
        Genera estructura de 7 d√≠as considerando:
        1. Prop√≥sito de cada d√≠a de la semana
        2. Ritmos circadianos del usuario
        3. Rutinas del perfil
        4. Proyectos y prioridades
        5. No-negociables como anclas
        """
        
        dias_estructurados = []
        
        for i in range(7):
            fecha_dia = semana_inicio + timedelta(days=i)
            dia_semana = DIAS_SEMANA[fecha_dia.strftime('%A')]
            
            # Estructura del d√≠a
            estructura = self._generar_estructura_dia(
                fecha=fecha_dia,
                proposito_dia=dia_semana["proposito"],
                perfil=perfil
            )
            
            dias_estructurados.append(estructura)
        
        return EstructuraSemanalCompleta(
            semana=f"{semana_inicio} - {semana_inicio + timedelta(days=6)}",
            dias=dias_estructurados,
            conflictos_semanales=self._detectar_conflictos_semana(dias_estructurados),
            sinergias_semanales=self._detectar_sinergias_semana(dias_estructurados)
        )
    
    def _generar_estructura_dia(
        self,
        fecha: date,
        proposito_dia: str,
        perfil: PerfilPersonal
    ) -> EstructuraDia:
        """
        Para un d√≠a espec√≠fico:
        
        1. ANCLAS (No-negociables):
           ‚Ä¢ Tiempos de rezo (precisos astron√≥micos)
           ‚Ä¢ Movimiento (del perfil)
           ‚Ä¢ Comida nutritiva
           ‚Ä¢ Sue√±o adecuado
        
        2. RUTINAS (Del perfil):
           ‚Ä¢ Deportes seg√∫n d√≠a
           ‚Ä¢ Batch cooking si corresponde
           ‚Ä¢ Compra semanal si toca
        
        3. PROYECTOS (Seg√∫n prioridad):
           ‚Ä¢ Horas asignadas por proyecto
           ‚Ä¢ Distribuidas seg√∫n energ√≠a del d√≠a
        
        4. APRENDIZAJE (Seg√∫n prioridad):
           ‚Ä¢ Tiempo semanal deseado
           ‚Ä¢ Distribuido en mejores momentos
        
        5. ESPACIO LIBRE (40%):
           ‚Ä¢ Para lo emergente
           ‚Ä¢ Para descanso
           ‚Ä¢ Para serendipia
        """
        
        dia_nombre = fecha.strftime('%A')
        dia_semana_nombre = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"][fecha.weekday()]
        
        # Tiempos lit√∫rgicos del d√≠a
        tiempos = calculador_tiempos.calcular_tiempos_hoy(fecha)
        
        # 1. ANCLAS - Tiempos de rezo + Estados Cero
        anclas = [
            {"tipo": "rezo", "momento": "fajr", "inicio": tiempos.fajr.inicio, "duracion": 15},
            {"tipo": "estado_cero", "momento": "fajr", "inicio": tiempos.fajr.inicio + timedelta(minutes=15), "duracion": 15},
            
            {"tipo": "rezo", "momento": "dhuhr", "inicio": tiempos.dhuhr.inicio, "duracion": 15},
            {"tipo": "estado_cero", "momento": "dhuhr", "inicio": tiempos.dhuhr.inicio + timedelta(minutes=15), "duracion": 15},
            
            {"tipo": "rezo", "momento": "asr", "inicio": tiempos.asr.inicio, "duracion": 15},
            {"tipo": "estado_cero", "momento": "asr", "inicio": tiempos.asr.inicio + timedelta(minutes=15), "duracion": 15},
            
            {"tipo": "rezo", "momento": "maghrib", "inicio": tiempos.maghrib.inicio, "duracion": 15},
            {"tipo": "ritual_maghrib", "momento": "maghrib", "inicio": tiempos.maghrib.inicio + timedelta(minutes=15), "duracion": 30},
            
            {"tipo": "rezo", "momento": "isha", "inicio": tiempos.isha.inicio, "duracion": 15},
            {"tipo": "estado_cero", "momento": "isha", "inicio": tiempos.isha.inicio + timedelta(minutes=15), "duracion": 15},
        ]
        
        # 2. NO-NEGOCIABLES (del perfil)
        no_negociables = [
            {"tipo": "movimiento", "ventana": "7:00-9:00", "duracion": 30},
            {"tipo": "comida_nutritiva", "ventana": "12:00-14:00", "duracion": 45},
            {"tipo": "lectura_profunda", "ventana": "libre", "duracion": 45}
        ]
        
        # 3. RUTINAS del d√≠a
        rutinas_dia = [r for r in perfil.rutinas_deportivas 
                       if dia_semana_nombre.lower() in [d.lower() for d in r.dias_semana]]
        
        # 4. PROYECTOS sugeridos
        proyectos_dia = self._distribuir_proyectos_dia(
            perfil.proyectos_desarrollo,
            dia_semana_nombre,
            proposito_dia
        )
        
        # 5. APRENDIZAJE sugerido
        aprendizaje_dia = self._distribuir_aprendizaje_dia(
            perfil.temas_aprendizaje,
            dia_semana_nombre
        )
        
        # 6. Calcular espacio libre
        tiempo_total = 24 * 60  # 1440 minutos
        tiempo_asignado = sum([a["duracion"] for a in anclas]) + \
                         sum([nn["duracion"] for nn in no_negociables]) + \
                         sum([r.duracion_minutos for r in rutinas_dia])
        
        tiempo_libre = tiempo_total - tiempo_asignado
        porcentaje_libre = (tiempo_libre / tiempo_total) * 100
        
        return EstructuraDia(
            fecha=fecha,
            dia_semana=dia_semana_nombre,
            proposito=proposito_dia,
            tiempos_liturgicos=tiempos,
            anclas=anclas,  # Rezo + Estado Cero
            no_negociables=no_negociables,
            rutinas=rutinas_dia,
            proyectos_sugeridos=proyectos_dia,
            aprendizaje_sugerido=aprendizaje_dia,
            espacio_libre_minutos=tiempo_libre,
            espacio_libre_porcentaje=porcentaje_libre,
            conflictos=[],
            sinergias=[]
        )
```

---

### **Paso 2: Orquestador Toma Estructura y Genera Plan**

```python
# backend/agentes/orquestador.py - MEJORADO

class AgenteOrquestador:
    
    async def generar_plan_dia_completo(
        self,
        intencion_usuario: str,
        estructura_dia: EstructuraDia,
        entrelazador: AgenteEntrelazador
    ) -> JornadaAlBordeCaos:
        """
        Genera plan pragm√°tico y preciso del d√≠a
        
        CORRESPONDENCIA CON ENTRELAZADOR:
        1. Toma ANCLAS (rezo + Estado Cero) ‚Üí Intocables
        2. Toma NO-NEGOCIABLES ‚Üí Intocables
        3. Toma RUTINAS del d√≠a ‚Üí Intocables (pero puede ajustar hora)
        4. Toma PROYECTOS sugeridos ‚Üí Base
        5. Toma APRENDIZAJE sugerido ‚Üí Base
        
        A√ëADE:
        6. Intenci√≥n del usuario ‚Üí Gu√≠a principal
        7. Bloques emergentes basados en intenci√≥n
        8. Puntos de decisi√≥n en tiempo real
        9. Mantiene ESPACIO LIBRE (40%)
        
        OUTPUT: Guion pragm√°tico completo
        """
        
        bloques_finales = []
        
        # 1. ANCLAS (Intocables)
        for ancla in estructura_dia.anclas:
            bloques_finales.append(BloqueTiempo(
                id=str(uuid.uuid4()),
                inicio_aprox=ancla["inicio"].strftime("%H:%M"),
                duracion=f"{ancla['duracion']}min",
                actividad=f"{ancla['tipo'].replace('_', ' ').title()} - {ancla['momento'].upper()}",
                rol="Ritual sagrado",
                energia_optima=3,
                flexible=False,  # ‚öì ANCLADO
                opciones_alternativas=[],
                origen="liturgico"
            ))
        
        # 2. NO-NEGOCIABLES (Intocables pero puede ajustar hora)
        for nn in estructura_dia.no_negociables:
            # Orquestador decide mejor hora dentro de ventana
            mejor_hora = await self._calcular_mejor_hora_no_negociable(
                nn,
                bloques_finales,
                estructura_dia.espacio_libre_minutos
            )
            
            bloques_finales.append(BloqueTiempo(
                id=str(uuid.uuid4()),
                inicio_aprox=mejor_hora,
                duracion=f"{nn['duracion']}min",
                actividad=f"‚öì {nn['tipo'].replace('_', ' ').title()}",
                rol="No-negociable",
                energia_optima=2,
                flexible=False,
                opciones_alternativas=[],
                origen="entrelazador"
            ))
        
        # 3. RUTINAS del d√≠a
        for rutina in estructura_dia.rutinas:
            bloques_finales.append(BloqueTiempo(
                id=str(uuid.uuid4()),
                inicio_aprox=rutina.hora_preferida,
                duracion=f"{rutina.duracion_minutos}min",
                actividad=f"üèÉ {rutina.nombre}",
                rol="Rutina",
                energia_optima=rutina.intensidad,
                flexible=True,  # Puede moverse 30-60min
                opciones_alternativas=[f"Mover a ¬±30min", "Reducir a 30min"],
                origen="entrelazador"
            ))
        
        # 4. BLOQUES EMERGENTES (basados en intenci√≥n)
        bloques_emergentes = await self._generar_bloques_emergentes(
            intencion=intencion_usuario,
            proyectos=estructura_dia.proyectos_sugeridos,
            aprendizaje=estructura_dia.aprendizaje_sugerido,
            espacio_disponible=estructura_dia.espacio_libre_minutos,
            bloques_ya_asignados=bloques_finales
        )
        
        bloques_finales.extend(bloques_emergentes)
        
        # 5. PUNTOS DE DECISI√ìN
        puntos_decision = self._generar_puntos_decision(
            bloques_finales,
            estructura_dia.tiempos_liturgicos
        )
        
        # 6. Validar que mantenemos 40% libre
        tiempo_asignado = sum([self._parsear_duracion(b.duracion) for b in bloques_finales])
        porcentaje_asignado = (tiempo_asignado / (24 * 60)) * 100
        
        if porcentaje_asignado > 60:
            print(f"‚ö†Ô∏è Sobrepasamos 60% asignado ({porcentaje_asignado}%), reduciendo bloques emergentes")
            bloques_finales = self._reducir_bloques_emergentes(bloques_finales)
        
        return JornadaAlBordeCaos(
            fecha=estructura_dia.fecha,
            intencion=intencion_usuario,
            bloques_sugeridos=sorted(bloques_finales, key=lambda b: b.inicio_aprox),
            puntos_decision=puntos_decision,
            no_negociables=[nn for nn in estructura_dia.no_negociables],
            espacio_libre_porcentaje=40
        )
```

---

### **Paso 3: Documentador Valida el Guion**

```python
# backend/agentes/documentador.py - MEJORADO

class AgenteDocumentador:
    
    async def generar_guion_dia(
        self,
        plan: JornadaAlBordeCaos,
        estructura: EstructuraDia
    ) -> str:
        """
        Genera guion completo del d√≠a para VALIDACI√ìN
        
        El usuario revisa este guion antes de que se ejecute
        """
        
        contenido = f"""---
tipo: guion-diario
fecha: {plan.fecha}
dia: {estructura.dia_semana}
proposito: {estructura.proposito}
---

# Guion del D√≠a - {estructura.dia_semana} {plan.fecha}

## Intenci√≥n
{plan.intencion}

## Prop√≥sito del D√≠a
{estructura.proposito} - {estructura.dia_semana}

---

## Timeline Completo

"""
        
        # Ordenar bloques por hora
        bloques_ordenados = sorted(plan.bloques_sugeridos, key=lambda b: b.inicio_aprox)
        
        for bloque in bloques_ordenados:
            tipo_emoji = {
                "liturgico": "üïå",
                "no_negociable": "‚öì",
                "rutina": "üèÉ",
                "trabajo_profundo": "üíª",
                "aprendizaje": "üìö",
                "emergente": "üåä"
            }.get(bloque.origen, "‚óØ")
            
            flex_icon = "üåä" if bloque.flexible else "‚öì"
            
            contenido += f"""
### {bloque.inicio_aprox} - {tipo_emoji} {bloque.actividad}
- **Duraci√≥n**: {bloque.duracion}
- **Energ√≠a**: {'üî•' * bloque.energia_optima}
- **Flexible**: {flex_icon} {'S√≠ (puede moverse)' if bloque.flexible else 'No (anclado)'}
{f"- **Rol**: {bloque.rol}" if bloque.rol else ""}

"""
        
        # Espacio libre
        contenido += f"""
---

## Espacio Emergente

**{estructura.espacio_libre_porcentaje:.0f}% del d√≠a** ({estructura.espacio_libre_minutos} minutos)

Para:
- Lo impredecible
- Descanso natural
- Serendipia
- Ajustes en tiempo real

---

## Validaci√≥n

¬øEste guion refleja tu intenci√≥n y respeta tus ritmos?

[ ] S√≠, ejecutar este plan
[ ] Necesita ajustes (describe qu√© cambiar)

---

*Generado por Entrelazador + Orquestador*
*Validado por: [Pendiente]*
"""
        
        return contenido
```

---

### **Paso 4: Guardian Mantiene el Organismo**

```python
# backend/agentes/guardian.py - MEJORADO

class AgenteGuardian:
    
    def monitorear_cumplimiento(
        self,
        plan: JornadaAlBordeCaos,
        estados_cero_hoy: List[EstadoCeroCompleto]
    ) -> ReporteMantenimiento:
        """
        Monitorea que el organismo funcione correctamente
        
        Verifica:
        1. ¬øSe cumplieron no-negociables?
        2. ¬øSe respet√≥ el 40% espacio libre?
        3. ¬øEstados Cero se completaron?
        4. ¬øHubo alineaci√≥n con intenci√≥n?
        5. ¬øEnerg√≠a fue la esperada?
        """
        
        # An√°lisis de cumplimiento
        no_neg_cumplidos = self._verificar_no_negociables(plan)
        estados_completados = len(estados_cero_hoy)
        espacio_libre_usado = self._calcular_espacio_libre_real()
        
        # Detecci√≥n de patrones
        patrones = self._detectar_patrones([
            "¬øSiempre se saltan no-negociables de tarde?",
            "¬øEnerg√≠a real vs esperada coincide?",
            "¬ø40% espacio libre es suficiente o mucho?"
        ])
        
        return ReporteMantenimiento(
            fecha=plan.fecha,
            no_negociables_cumplidos=no_neg_cumplidos,
            estados_cero_completados=estados_completados,
            espacio_libre_respetado=espacio_libre_usado >= 35,  # Min 35%
            patrones_detectados=patrones,
            sugerencias_mejora=[
                "Mover gym de 18:00 a 17:00 (menos cansancio)",
                "A√±adir siesta 15min despu√©s de Dhuhr"
            ]
        )
```

---

## üîó **Integraci√≥n con Pareja/Familia/Amigos**

```python
# backend/agentes/orquestador.py

async def generar_plan_coordinado(
    self,
    mi_intencion: str,
    mi_estructura: EstructuraDia,
    calendarios_cercanos: List[CalendarioExterno]
) -> JornadaCoordinada:
    """
    Genera plan considerando calendarios de pareja/familia
    
    Input:
    - Mi intenci√≥n y estructura
    - Calendarios de: pareja, familia, amigos cercanos
    
    Proceso:
    1. Identificar bloques compartidos posibles
    2. Detectar conflictos con sus calendarios
    3. Sugerir momentos de conexi√≥n
    4. Respetar espacio individual
    
    Output:
    - Plan personal con momentos de conexi√≥n
    - Invitaciones sugeridas
    - Bloques de calidad en pareja/familia
    """
    
    # 1. Analizar disponibilidad de pareja
    disponibilidad_pareja = self._analizar_calendario_externo(
        calendarios_cercanos["pareja"]
    )
    
    # 2. Identificar ventanas comunes
    ventanas_comunes = self._encontrar_ventanas_comunes(
        mi_estructura,
        disponibilidad_pareja
    )
    
    # 3. Sugerir momentos de calidad
    momentos_sugeridos = [
        {"tipo": "comida_juntos", "ventana": "13:00-14:00", "prioridad": "alta"},
        {"tipo": "paseo_tarde", "ventana": "18:00-19:00", "prioridad": "media"},
        {"tipo": "ritual_noche", "ventana": "21:00-22:00", "prioridad": "alta"}
    ]
    
    # 4. Integrar en plan respetando espacio individual
    plan_coordinado = await self._integrar_momentos_compartidos(
        mi_plan=mi_estructura,
        momentos_compartidos=momentos_sugeridos,
        ventanas_disponibles=ventanas_comunes,
        mantener_espacio_individual=True  # 30% m√≠nimo tiempo solo
    )
    
    return plan_coordinado
```

---

## üìã **Plan de Ejecuci√≥n**

### **Fase 1: Estructura Base** ‚è±Ô∏è 4 horas

```
1. Extender EstructuraDia con prop√≥sitos
2. Implementar PropositoEstadoCero
3. Anclas precisas (rezo + Estado Cero)
4. Validar 40% espacio libre
```

### **Fase 2: Correspondencia Entrelazador ‚Üî Orquestador** ‚è±Ô∏è 3 horas

```
1. generar_estructura_semanal_completa()
2. generar_plan_dia_completo()
3. Endpoint /api/estructura-semanal
4. Endpoint /api/plan-dia-coordinado
```

### **Fase 3: Actualizaci√≥n Incremental** ‚è±Ô∏è 4 horas

```
1. actualizar_espejo_con_estado_cero()
2. Frontend con polling cada 30s
3. Visualizaci√≥n de cambios
4. Historial de refinamientos
```

### **Fase 4: Integraci√≥n Social** ‚è±Ô∏è 3 horas

```
1. Analizar calendarios externos
2. Sugerir momentos compartidos
3. Respetar espacio individual
4. Armon√≠a familiar/pareja
```

---

## ‚ú® **Principios de la Estructura**

```
1. FLEXIBLE pero ESTRUCTURADA
   ‚Ä¢ Anclas fijas (rezo, no-negociables)
   ‚Ä¢ Bloques m√≥viles (trabajo, aprendizaje)
   ‚Ä¢ Espacio emergente (40%)

2. ITERATIVA
   ‚Ä¢ Se refina con cada Estado Cero
   ‚Ä¢ Aprende de feedback real
   ‚Ä¢ Ajusta seg√∫n energ√≠a observada

3. HOL√çSTICA
   ‚Ä¢ 4 dimensiones integradas
   ‚Ä¢ Ritmos circadianos respetados
   ‚Ä¢ Momentos lit√∫rgicos priorizados

4. SOCIAL
   ‚Ä¢ Coordinada con pareja/familia
   ‚Ä¢ Invitaciones autom√°ticas
   ‚Ä¢ Respeta espacio individual

5. GUIADA POR EL CORAZ√ìN
   ‚Ä¢ La mente propone (Orquestador)
   ‚Ä¢ El coraz√≥n decide (Estado Cero)
   ‚Ä¢ El organismo ejecuta (Guardian)
```

---

üïå **¬øEmpezamos con Fase 1: Estructura Base (4h)?**

Esto establecer√° los cimientos correctos para todo lo dem√°s.

